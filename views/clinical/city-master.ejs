<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>LifeLinker</title>
<%- include('../header'); -%>
  <!-- main content start -->
<div class="main-content">

<div class="row content-top-gap2">
 <div class="col-lg-12">
   	<nav class="navbar navbar-expand-lg navbar-light bg-white">
	<a class="navbar-brand text-center mr-5" href="#">
	<span class="dash-icon"><i class="fas fa-tachometer-alt"></i></span>
	Dashboard
	</a>
	<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
	<span class="navbar-toggler-icon"></span>
	</button>
	<div class="collapse navbar-collapse" id="navbarNav">
	<ul class="navbar-nav">
	  <li class="nav-item active text-center mr-5">
		<a class="nav-link" href="#">
		<span class="dash-icon"><i class="far fa-user"></i></span>
	    Master
		</a>
	  </li>
	  <li class="nav-item text-center mr-5">
		<a class="nav-link" href="#">
		<span class="dash-icon"><i class="fas fa-exchange-alt"></i></span>
	    Transaction
		</a>
	  </li>
	  <li class="nav-item text-center mr-5">
		<a class="nav-link" href="#">
		<span class="dash-icon"><i class="fas fa-hand-holding-medical"></i></span>
	    Patient 360
		</a>
	  </li>
	  <li class="nav-item text-center mr-5">
		<a class="nav-link" href="#">
		<span class="dash-icon"><i class="fas fa-receipt"></i></span>
	    Outside Reciept
		</a>
	  </li>
	  <li class="nav-item text-center mr-5">
		<a class="nav-link" href="#">
		<span class="dash-icon"><i class="fas fa-file-invoice"></i></span>
	    Outpatient Department
		</a>
	  </li>
	  <li class="nav-item text-center mr-5">
		<a class="nav-link" href="#">
		<span class="dash-icon"><i class="fas fa-chart-line"></i></span>
	    Analytics
		</a>
	  </li>
	  <li class="nav-item text-center mr-5">
		<a class="nav-link" href="#">
		<span class="dash-icon"><i class="far fa-clock"></i></span>
	    Waiting List
		</a>
	  </li>
	  <li class="nav-item text-center mr-5">
		<a class="nav-link" href="#">
		<span class="dash-icon"><i class="fas fa-wrench"></i></span>
	    Adminstration
		</a>
	  </li>
	  <li class="nav-item text-center">
		<a class="nav-link" href="#">
		<span class="dash-icon"><i class="fas fa-spinner"></i></span>
	    Additional
		</a>
	  </li>

	</ul>
	</div>
	</nav>
  </div>
 </div>
  <!-- content -->
  <div class="container-fluid">

    <!--nav aria-label="breadcrumb">
      <ol class="breadcrumb my-breadcrumb">
        <li class="breadcrumb-item"><a href="index.html">Home</a></li>
        <li class="breadcrumb-item active" aria-current="page">Dashboard</li>
      </ol>
    </nav>
    <div class="welcome-msg pt-3 pb-4">
      <h1>Hi <span class="text-primary">John</span>, Welcome back</h1>
      <p>Very detailed & featured admin.</p>
    </div-->

    <!-- charts -->

    <div class="chart">
      <div class="row">
		
		<div class="col-lg-12 pl-lg-2 chart-grid mt-1">
        <!--part 1-->
		  <div class="card card_border">
            <div class="">
			<div class="col-xl-12 pr-xl-2 p-heading">
			 <h6 class="p-text">City Master</h6>
			</div>
			 
			 <div class="col-xl-12 pr-xl-2 mb-4">
        <div id="errordiv1"></div>
			 <form id="city_master_form" method="post" class="mt-2">
        <input type="hidden" id="query" value="0" name="query">
        <input type="hidden" id="itemId" value="0" name="itemid">
				<div class="row">
			 <div class="col-xl-3 pr-xl-2">
                        <div class="form-group">
                            <label for="exampleInputEmail1" class="input__label" >Code</label>
                            <input type="text" class="form-control input-style" id="city_master_code" name="city_master_code"
                                aria-describedby="emailHelp" placeholder="" data-validation="required" data-error-message="Code is required.">
                        </div>
					</div>
					
			<div class="col-xl-3 pr-xl-2">
                        <div class="form-group">
                          <label for="exampleInputEmail1" class="input__label">Country</label>
                          <select class="form-control input-style" id="country" name="country" data-validation="required" data-error-message="Country is required.">
             <option value="">Select</option>
             <option value="INIDA">INDIA</option>
            </select>
                            
                        </div>
					</div>
			
			<div class="col-xl-3 pr-xl-2">
                        <div class="form-group">
                            <label for="exampleInputEmail1" class="input__label">State</label>
                            <select class="form-control input-style" onchange="loadCity(this)" id="state" name="state" data-validation="required" data-error-message="State is required.">
							 <option value="">Select</option>
							</select>
                        </div>
					</div>
					
			<div class="col-xl-3">
                        <div class="form-group">
                           

                          <label for="exampleInputEmail1" class="input__label" >City</label>
                            <select class="form-control input-style" id="city" name="city" data-validation="required" data-error-message="City is required.">
							 <option value="">Select</option>
							</select>
              <input type="text" class="form-control input-style" id="hid_div" data-validation
              aria-describedby="emailHelp" style="display:none;" value='<%= a.city %>'>
             
                        </div>
					</div>
					
			</div>
			<div class="text-right">

      <button type="button"  id="mod-btn" onclick="updateQuery()" class="btn btn-primary btn-style mt-3 mr-2"><strong>Modify</strong></button>
			<button type="submit" id="sub-btn" class="btn btn-primary btn-style mt-3"><i class="far fa-save"></i> Save</button>
      <button type="button"  class="btn btn-danger btn-style mt-3 ml-2 mr-3" onclick="window.location.href = '/clinic/3';"><strong><i class="fas fa-times"></i> Cancel</strong></button>
			</div>
			
			</form>
            </div>
			
			</div>
          </div>
		  <!--part 1 ended-->
		  
        </div>
      </div>
    </div>
    <!-- //charts -->




  <!--footer section start-->
<%- include('../footer'); -%>
<script>

 
if('<%= a.id %>'!==''){
  $('#city').hide();
  $('#hid_div').show();
$('input[data-validation], select[data-validation]').prop('disabled', true);
document.getElementById('sub-btn').disabled = true;
document.getElementById('mod-btn').disabled = false;

}else{

document.getElementById('mod-btn').disabled = true;
}

document.getElementById('city_master_code').value = '<%= a.city_master_code %>';
document.getElementById('country').value = '<%= a.country %>';
document.getElementById('itemId').value = '<%= a.id %>';
const state= '<%= a.state %>';

 if('<%= a.id %>'!==''){
    loadCity(state);
    document.getElementById('city').value = '<%= a.city %>';
  }
  if('<%= a.status %>'!=='true'){
        document.getElementById('mod-btn').disabled = true;
      }
</script>
<script>
  function updateQuery(){
    document.getElementById('query').value=1;
$('#mod-btn').prop('disabled', true);
 
$('#city').show();
$('#hid_div').hide(); 

$('input[data-validation], select[data-validation]').prop('disabled', false);

$('#city_master_code').prop('disabled', true);
document.getElementById('sub-btn').disabled = false;
      }
      

  function loadCity(a) {
    $.ajax({
      url: '/clinic/cities', 
      type: 'GET',
      success: function(data) {
        console.log(data);
        
        let selectOptions = '<option value="">Select city</option>'; // Initial select option
        
        // Filter cities based on selected stateCode
        const filteredCities = data.filter(city => city.stateCode === a.value);
        
        filteredCities.forEach(function(city) {
          selectOptions += `
            <option value="${city.cityName}">${city.cityName}</option>
          `;
        });
        
        $('#city').html(selectOptions); // Populate select options
      },
      error: function(xhr, status, error) {
        console.error('Error fetching cities:', error);
      }
    });
  }
  
 

 
  
  
    $(document).ready(function() {
      function loadState(a){
              fetch('/clinic/reloadState')
                  .then(response => response.json())
                  .then(data => {
                      const dropdown = document.getElementById(a);
                      data.forEach(state => {
                          const option = document.createElement('option');
                          option.value = state.stateCode;
                          option.textContent = state.stateName;
                          dropdown.appendChild(option);
                          
                      });
                      dropdown.value = '<%= a.state %>';
                  })
                  .catch(error => console.error('Error fetching states:', error));
              }
           loadState('state');
           
  
  
        // Handle form submission
        $('#location_form').on('submit', function(event) {
            event.preventDefault();
            // Perform form submission logic here
            // Example: Fetch table data based on selected filters
            const countryId = $('#country').val();
            const stateId = $('#state').val();
            const cityId = $('#city').val();
            fetchTableData(countryId, stateId, cityId);
        });
  
        // Fetch table data based on filters
       
        
    });
  </script>
  <script>
    $(document).ready(function() {
    console.log("Document is ready"); // Debugging log
    
    
    
    
    function validateForm(formId, errorDivId) {
    $(formId).on('submit', function(event) {
    event.preventDefault();
    console.log("Form submission prevented"); // Debugging log
    let isValid = true;
    let errorMessage = '';
    
    // Convert the jQuery collection to an array and reverse it
    const inputs = $(this).find('input,select').toArray().reverse();
    let formData = {};
    
    // Iterate over the reversed array
    inputs.forEach(function(input) {
        const $input = $(input);
        const validationRules = $input.data('validation');
        const customErrorMessage = $input.data('error-message') || 'This field is required.';
        
        $input.removeClass('is-invalid');
        if (validationRules) {
            const rules = validationRules.split(' ');
    
            rules.forEach(rule => {
                switch (rule) {
                    case 'required':
                        if (!$input.val()) {
                            isValid = false;
                            errorMessage = customErrorMessage;
                            console.log(`Validation failed: ${customErrorMessage}`); // Debugging log
                            $input.addClass('is-invalid');
                        }
                        break;
                    case 'email':
                        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                        if (!emailRegex.test($input.val())) {
                            isValid = false;
                            errorMessage = customErrorMessage;
                        }
                        break;
                    // Add more cases here for different validation rules
                }
            });
        }
    
        // Collect form data
        formData[$input.attr('name')] = $input.val();
    });
    
    if (isValid) {
        $.ajax({
            url: '/clinic/cityMaster',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(formData),
            success: function(response) {
                alert(response.msg);
                $(errorDivId).removeClass('alert-danger').addClass('alert-success').text(response.msg).show();
                console.log('Response:', response);
            },
            error: function(xhr, status, error) {
              const response = JSON.parse(xhr.responseText);
              $(errorDivId).removeClass('alert-success').addClass('alert-danger').text(response.msg).show();
                console.error('Error:', error);
            }
        });
    } else {
        alert(errorMessage);
        $(errorDivId).removeClass('alert-success').addClass('alert-danger').text(errorMessage).show();
        // $(errorDivId).text(errorMessage).show();
    }
    });
    }
    
    // Initialize validation on the form
    validateForm('#city_master_form', '#errordiv1');
    });
    </script>