<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>LifeLinker</title>

 <%- include('../header'); -%>
    <!-- //header-ends -->
    <!-- main content start -->
    <div class="main-content">

      <div class="row content-top-gap2">
        <div class="col-lg-12">
          <nav class="navbar navbar-expand-lg navbar-light bg-white">
            <a class="navbar-brand text-center mr-5" href="#">
              <span class="dash-icon"><i class="fas fa-tachometer-alt"></i></span>
              Dashboard
            </a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
              aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
              <ul class="navbar-nav">
                <li class="nav-item active text-center mr-5">
                  <a class="nav-link" href="#">
                    <span class="dash-icon"><i class="far fa-user"></i></span>
                    Master
                  </a>
                </li>
                <li class="nav-item text-center mr-5">
                  <a class="nav-link" href="#">
                    <span class="dash-icon"><i class="fas fa-exchange-alt"></i></span>
                    Transaction
                  </a>
                </li>
                <li class="nav-item text-center mr-5">
                  <a class="nav-link" href="#">
                    <span class="dash-icon"><i class="fas fa-hand-holding-medical"></i></span>
                    Patient 360
                  </a>
                </li>
                <li class="nav-item text-center mr-5">
                  <a class="nav-link" href="#">
                    <span class="dash-icon"><i class="fas fa-receipt"></i></span>
                    Outside Reciept
                  </a>
                </li>
                <li class="nav-item text-center mr-5">
                  <a class="nav-link" href="#">
                    <span class="dash-icon"><i class="fas fa-file-invoice"></i></span>
                    Outpatient Department
                  </a>
                </li>
                <li class="nav-item text-center mr-5">
                  <a class="nav-link" href="#">
                    <span class="dash-icon"><i class="fas fa-chart-line"></i></span>
                    Analytics
                  </a>
                </li>
                <li class="nav-item text-center mr-5">
                  <a class="nav-link" href="#">
                    <span class="dash-icon"><i class="far fa-clock"></i></span>
                    Waiting List
                  </a>
                </li>
                <li class="nav-item text-center mr-5">
                  <a class="nav-link" href="#">
                    <span class="dash-icon"><i class="fas fa-wrench"></i></span>
                    Adminstration
                  </a>
                </li>
                <li class="nav-item text-center">
                  <a class="nav-link" href="#">
                    <span class="dash-icon"><i class="fas fa-spinner"></i></span>
                    Additional
                  </a>
                </li>

              </ul>
            </div>
          </nav>
        </div>
      </div>
      <!-- content -->
      <div class="container-fluid">

        <div class="chart">
          <div class="row">
<div class="col-lg-12 pl-lg-2 mt-2">
                      <h4 class="primary">Doctor</h4>
                    </div>
            <div class="col-lg-12 pl-lg-2 chart-grid mt-1">

              <!-- form start here -->
               <div id="errordiv1"></div>
              <form id="doctorForm" enctype="multipart/form-data">
                <input type="hidden" name="query" id="query" value="0">
                <input type="hidden" name="itemid" id="itemid" value='<%= a.id %>'>
                <div class="card card_border">
                    <div>
                     
                        <div class="card">
                            <div class="card-body">
                                <div class="form-row">
                                    <div class="col-md-2">
                                      <div id="imageContainer">
                                        <img id="displayImage" src=""  class="far fa-user" style="width: 100%;font-size: 120px;margin-bottom: 10px; max-width: 110px;">
                                    </div>
                                          <!-- <i class="far fa-user" id="file-info"  style="width: 100%;font-size: 120px;margin-bottom: 10px;"></i> -->
                                          <input id="imageInput" name="doc_photo" type="file" accept="image/*" style="display: none;" data-validation="required" data-error-message="Photo is required.">
                                          <button type="button" class="btn btn-primary btn-style btn-change" onclick="document.getElementById('imageInput').click();"><i
                                                  class="fas fa-camera"></i></button>
                                          <!-- <button type="submit" class="btn btn-primary btn-style btn-change ml-2"><i -->
                                                  <!-- class="fas fa-upload"></i></button> -->
                                      </div>
            
                                    <div class="col-md-10">
                                        <div class="row">
                                            <div class="col-md-3 mb-3">
                                                <div class="form-group">
                                                    <label class="input__label" for="full_name">Full Name</label>
                                                    <input id="doc_name" name="doc_name" type="text"
                                                        class="form-control input-style" placeholder="" 
                                                        data-validation="required" data-error-message="Full Name is required.">
                                                </div>
                                            </div>
                                            <div class="col-md-3 mb-3">
                                                <div class="form-group">
                                                    <label class="input__label" for="date_of_birth">Date of Birth</label>
                                                    <input id="doc_dob" name="doc_dob" type="date" min="1924-01-01" max="2024-03-31"
                                                        class="form-control input-style" placeholder="" max="getMaxDate()"
                                                        data-validation="required" data-error-message="Date of Birth is required.">
                                                </div>
                                            </div>
                                            <div class="col-md-3 mb-3">
                                                <div class="form-group">
                                                    <label class="input__label" for="specialization">Specialization</label>
                                                    <select id="doc_spec" name="doc_spec" class="form-control input-style" data-validation="required" data-error-message="Select Doctor Category">
                                                      <option value="">Select</option>                                                      
                                                  </select>
                                                    
                                                </div>
                                            </div>
                                            <div class="col-md-3 mb-3">
                                                <div class="form-group">
                                                    <label class="input__label" for="sub_specialization">Sub-Specialization</label>
                                                    <select id="doc_sub_spec" name="doc_sub_spec" class="form-control input-style" data-validation="required" data-error-message="Select Doctor Category">
                                                      <option value="">Select</option>                                                      
                                                  </select>
                                                   
                                                </div>
                                            </div>
                                            <div class="col-md-3 mb-3">
                                                <div class="form-group">
                                                    <label class="input__label" for="doctor_type">Doctor Type</label>
                                                    <select id="doc_type" name="doc_type" class="form-control input-style" data-validation="required" data-error-message="Select Doctor Type">
                                                      <option value="">Select</option>                                                      
                                                      <option value="FULL TIME">FULL TIME</option>                                                      
                                                      <option value="VISITING">VISITING</option>                                                      
                                                      <option value="REFERRAL">REFERRAL</option>                                                      
                                                  </select>
                                                    
                                                </div>
                                            </div>
                                            <div class="col-md-3 mb-3">
                                                <div class="form-group">
                                                    <label class="input__label" for="doctor_category">Doctor Category</label>
                                                    <select id="doc_catg" name="doc_catg" class="form-control input-style" data-validation="required" data-error-message="Select Doctor Category">
                                                      <option value="">Select</option>                                                      
                                                  </select>
                                                   
                                                </div>
                                            </div>
                                            <div class="col-md-3 mb-3">
                                                <div class="form-group">
                                                    <label class="input__label" for="marketing_executives">Marketing Executives</label>
                                                    <select id="doc_mark_exec" name="doc_mark_exec" class="form-control input-style" data-validation="required" data-error-message="Marketing Executives is required">
                                                      <option value="">Select</option>                                                      
                                                     
                                                      
                                                  </select>
                                                   
                                                </div>
                                            </div>
                                            <div class="col-md-3 mb-3">
                                                <div class="form-group">
                                                    <label class="input__label" for="gender">Gender</label>
                                                    <select id="doc_gender" name="doc_gender" class="form-control input-style" data-validation="required" data-error-message="Select Gender.">
                                                        <option value="">Select</option>                                                      
                                                        <option value="Male">Male</option>
                                                        <option value="female">Female</option>
                                                        <option value="other">Other</option>
                                                        
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-3 mb-3">
                                                <div class="form-group">
                                                    <label class="input__label" for="signature">Signature</label>
                                                    <input id="signature" name="doc_sign"
                                                        class="form-control input-style" type="file" accept="image/*" style="display: none;"  placeholder="" data-validation="required" data-error-message="Signature is required.">
                                                        <div id="imageContainer">
                                                          <img id="displaySign" src=""  style="max-width: 150px; max-height: 50px;">
                                                      </div>
                                                        <button type="button" class="btn btn-primary btn-style btn-change" onclick="document.getElementById('signature').click();"><i
                                                          class="fas fa-camera" style="margin-top: 1px;"></i></button>
                                                      </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
            
                        <div class="card">
                          <div class="card-body">
                              <div class="form-row">
                                  
                              </div>
                      


                              <nav>
                                <div class="nav nav-tabs" id="nav-tab" role="tablist">
                                    <button class="nav-link active" id="nav-followup-tab" data-bs-toggle="tab"
                                        data-bs-target="#nav-followup" type="button" role="tab"
                                        aria-controls="nav-followup" aria-selected="true">
                                        <i class="fas fa-exchange-alt"></i> Personal Information
                                    </button>
                                    <button class="nav-link" id="nav-appointment-tab" data-bs-toggle="tab"
                                        data-bs-target="#nav-appointment" type="button" role="tab"
                                        aria-controls="nav-appointment" aria-selected="false">
                                        <i class="fas fa-calendar-alt"></i>Clinic - Department 
                                    </button>
                                    <button class="nav-link" id="nav-visited-tab" data-bs-toggle="tab"
                                        data-bs-target="#nav-visited" type="button" role="tab"
                                        aria-controls="nav-visited" aria-selected="false">
                                        <i class="fas fa-map-marker-alt"></i>Allocate Classification
                                    </button>
                                </div>
                            </nav>

                            <!-- MODEL -->
                            <div class="col-md-12 tab-content" id="nav-tabContent">

                              <div class="tab-pane fade show active" id="nav-followup" role="tabpanel"
                                  aria-labelledby="nav-followup-tab">
                                  
                              <div class="form-row">
                                <div class="col-3 mb-3">
                                  
                                    <div class="form-group">
                                        <label class="input__label" for="martial_status">Martial Status</label>
                                        <select id="doc_marital_status" name="doc_marital_status" class="form-control input-style" 
                                            data-validation="required" data-error-message="Martial Status is required.">
                                            <option value="">Select</option>
                                            <option value="Married">Married</option>
                                            <option value="Unmarried">Unmarried</option>
                                            <option value="other">Other</option> 
                                            
                                        </select>
                                    </div>
                                </div>
                                <div class="col-3 mb-3">
                                    <div class="form-group">
                                        <label class="input__label" for="employee_number">Employee Number</label>
                                        <input id="doc_emp_no" name="doc_emp_no" type="text" class="form-control input-style"
                                            placeholder=""  data-validation="required"
                                            data-error-message="Employee Number is required.">
                                    </div>
                                </div>
                                <div class="col-3 mb-3">
                                    <div class="form-group">
                                        <label class="input__label" for="pf_number">PF Number</label>
                                        <input id="doc_pf_no" name="doc_pf_no" type="text" class="form-control input-style"
                                            placeholder="" data-validation="required"
                                            data-error-message="PF Number is required.">
                                    </div>
                                </div>
                                <div class="col-3 mb-3">
                                    <div class="form-group">
                                        <label class="input__label" for="pan_number">Pan Number</label>
                                        <input id="doc_pan_no" name="doc_pan_no" type="text" class="form-control input-style"
                                            placeholder="" data-validation="required"
                                            data-error-message="Pan Number is required.">
                                    </div>
                                </div>
                            </div>
                    
                            <div class="form-row">
                                <div class="col-3 mb-3">
                                    <div class="form-group">
                                        <label class="input__label" for="date_of_joining">Date of Joining</label>
                                        <input id="doc_doj" name="doc_doj" type="date" class="form-control input-style"
                                            placeholder="" data-validation="required"
                                            data-error-message="Date of Joining is required.">
                                    </div>
                                </div>
                                <div class="col-3 mb-3">
                                    <div class="form-group">
                                        <label class="input__label" for="access_card_no">Access Card Number</label>
                                        <input id="doc_access_card_no" name="doc_access_card_no" type="text" class="form-control input-style"
                                            placeholder=""  data-validation="required"
                                            data-error-message="Access Card Number is required.">
                                    </div>
                                </div>
                                <div class="col-3 mb-3">
                                    <div class="form-group">
                                        <label class="input__label" for="registration_number">Registration Number</label>
                                        <input id="doc_reg_no" name="doc_reg_no" type="text" class="form-control input-style"
                                            placeholder=""  placeholder=""  data-validation="required"
                                            data-error-message="Registration Number  is required.">
                                    </div>
                                </div>
                                <div class="col-3 mb-3">
                                    <div class="form-group">
                                      <label class="input__label" for="email_id">Email ID</label>
                                      <input id="email_id" name="doc_email" type="email" class="form-control input-style"
                                          placeholder=""  placeholder=""  data-validation="required"
                                          data-error-message="Email id is required.">
                                  </div>
                              </div>
                          </div>
                  
                          <div class="form-row">
                              <div class="col-12 mb-3">
                                  <div class="form-group">
                                      <label class="input__label" for="experience">Experience</label>
                                      <input id="experience" name="doc_experience" type="text" class="form-control input-style"
                                          placeholder=""  placeholder=""  data-validation="required"
                                          data-error-message="Experience is required.">
                                  </div>
                              </div>
                          </div>
                  
                          <div class="form-row">
                              <div class="col-12 mb-3">
                                  <div class="form-group">
                                      <label class="input__label" for="education">Education</label>
                                      <input id="education" name="doc_education" type="text" class="form-control input-style"
                                          placeholder=""  placeholder=""  data-validation="required"
                                          data-error-message="Education is required.">
                                  </div>
                              </div>
                          </div>
                              </div>


                              <div class="tab-pane fade show "  id="nav-appointment" role="tabpanel"
                                  aria-labelledby="nav-appointment-tab">
                                  <label class="input__label"  for="">Department</label>
                                  <input id="searchBox" type="text">
                                  <table class="table2" id="tableid">
                                    <thead>
                                      <tr>
                                        <th >&nbsp;</th>
                                        <th >Department</th>
                                        
                                      </tr>
                                    </thead>
                                    <tbody id="depts"></tbody>
                                  </table>
                                  <div id="paginationControls"></div>


                              </div>

                              <div class="tab-pane fade show " id="nav-visited" role="tabpanel"
                              aria-labelledby="nav-visited-tab">

                              <label class="input__label"  for="">Classification</label>
                              <input id="searchBox2" type="text">
                              <table class="table2" id="tableid2">
                                <thead>
                                  <tr>
                                    <th >&nbsp;</th>
                                    <th >Classification</th>
                                    
                                  </tr>
                                </thead>
                                <tbody id="classifications"></tbody>
                              </table>
                              <div id="paginationControls2"></div>

                            </div>
  
                            
  
                          </div>


                    
                            <div class="form-row">
                                <div class="col-12 mb-3">
                                    <div class="form-group">
                                        <button type="button" class="btn btn-style mt-3 btn-primary btn-style"><strong> Doctor Service
                                                Linking</strong></button>
                                    </div>
                                </div>
                            </div>
                    
                            <div class="form-row"></div>
                        </div>
                    </div>
                    
                    <div class="form-group mt-1 mb-3 text-right">
                      <button type="submit" class="btn-success btn-style btn mr-2"  disabled id="mod-btn" onclick="updateQuery()"><strong><i
                        class="fa-regular fa-pen-to-square" ></i> Modify</strong></button>
                
                        
                        <!-- <button type="button" id="cancel-btn" class="btn-danger btn-style btn" onclick="window.location.reload()">
                          <strong><i class="fa fa-times"></i> Cancel</strong>
                        </button> -->
                        
                            <button type="submit" id="sub-btn" class="btn-primary btn-style btn"><strong><i
                                class="far fa-save"></i> Save</strong></button>
                                <button type="button"  class="btn btn-danger btn-style ml-2 mr-3" onclick="window.location.href = '/clinic/12';"><strong><i class="fas fa-times"></i> Cancel</strong></button>
                      </div>
                    
                      
            
                        <!-- Past your code here ends -->
                    </div>
                </div>
            </form>
            
            </div>
                <!--footer section start-->
           <%-include('../footer');  -%>
                 
           <script type="module">
            console.log('<%= a.doc_dept %>')
              

            import {pagi_search} from '../javascripts/pagi_search.js'

            const x=''
             function fetchData() {
                $.ajax({
                  url: '/clinic/get-dept-details',
                  type: 'GET',
                  success: function(data) {
                    let tableRows = '';
                    data.reverse();
                    data.forEach(function(item) {
                    
                      // alert(id)
                      // console.log(item)
                      tableRows += `
                        <tr data-dept-id="${item.id}">
      <td><input type="checkbox"  name="doc_dept" value="${item.dept_code} ${x.includes(`${item.dept_code}`) ? 'checked' : '' }"></td>
    
      <td style="display:none;">${item.dept_code}</td>
      <td>${item.dept_desc}</td>
     
       
    </tr>
                      `;
                    });


                   
                    $('#depts').html(tableRows);
                    pagi_search('#searchBox','#tableid','#paginationControls')
                  },
                  error: function(xhr, status, error) {
                    console.error('Error fetching classification details:', error);
                  }
                });
              }
            
              // Fetch data on page load
              fetchData()

              function fetchDataClass() {
    $.ajax({
      url: '/clinic/get-classification-details',
      type: 'GET',
      success: function(data) {
        let tableRows = '';
        data.reverse();
        data.forEach(function(item) {
          tableRows += `
            <tr data-clas-id="${item.id}">
               <td><input type="checkbox" name="doc_class" value="${item.classification_code}" ${'<%= a.doc_class %>'.includes(`${item.classification_code}`) ? 'checked' : '' }></td>
    
            <td style="display:none;">${item.classification_code}</td>
            <td>${item.classification_desc}</td>
             </tr>
          `;
        });

      
        $('#classifications').html(tableRows);
        pagi_search('#searchBox2','#tableid2','#paginationControls2')
      
      },
      error: function(xhr, status, error) {
        console.error('Error fetching classification details:', error);
      }
    });
  }

  fetchDataClass()


           </script>

            <script>
             
             function updateQuery(){
document.getElementById('query').value=1;
$('#mod-btn').prop('disabled', true);   
$('input[data-validation],select[data-validation],textarea[data-validation]').prop('disabled', false);
$('#emp_code').prop('disabled', true);
document.getElementById('sub-btn').disabled = false;
}
if('<%= a.id %>'!==''){
    $('input[data-validation],select[data-validation],textarea[data-validation]').prop('disabled', true);
document.getElementById('sub-btn').disabled = true;
document.getElementById('mod-btn').disabled = false;

}else{

document.getElementById('mod-btn').disabled = true;
}
if('<%= a.status %>'!=='true'){
        document.getElementById('mod-btn').disabled = true;
      }
           
              document.getElementById('doc_name').value = '<%= a.doc_name %>';
              
              document.getElementById('doc_dob').value = new Date('<%= a.doc_dob %>').toISOString().split('T')[0];// Format DATE to YYYY-MM-DD
              document.getElementById('doc_spec').value = '<%= a.doc_spec %>';
              document.getElementById('doc_sub_spec').value = '<%= a.doc_sub_spec %>';
              document.getElementById('doc_type').value = '<%= a.doc_type %>';
              document.getElementById('doc_catg').value = '<%= a.doc_catg %>';
              document.getElementById('doc_mark_exec').value = '<%= a.doc_mark_exec %>';
              document.getElementById('doc_gender').value = '<%= a.doc_gender %>';
              document.getElementById('doc_sign').value = '<%= a.doc_sign %>';
              document.getElementById('doc_marital_status').value = '<%= a.doc_marital_status %>';
              document.getElementById('doc_emp_no').value = '<%= a.doc_emp_no %>';
              document.getElementById('doc_pf_no').value = '<%= a.doc_pf_no %>';
              document.getElementById('doc_pan_no').value = '<%= a.doc_pan_no %>';
              document.getElementById('doc_doj').value = '<%= a.doc_doj %>'; // Format DATE to YYYY-MM-DD
              document.getElementById('doc_access_card_no').value = '<%= a.doc_access_card_no %>';
              document.getElementById('doc_reg_no').value = '<%= a.doc_reg_no %>';
              document.getElementById('doc_email').value = '<%= a.doc_email %>';
              document.getElementById('doc_experience').value = '<%= a.doc_experience %>';
              document.getElementById('doc_education').value = '<%= a.doc_education %>';
             
          
            </script>
            


            <script type="module">
             import { loadDocCat } from '../javascripts/data.js';
             import { loadSpec } from '../javascripts/data.js';
             import { loadSubSpec } from '../javascripts/data.js';
             import { loadEmp } from '../javascripts/data.js';

             loadDocCat('doc_catg');
             loadEmp('doc_mark_exec')

             document.getElementById('doc_spec').addEventListener('change', function() {
              
    const selectedSpec = this.value;
    loadSubSpec('doc_sub_spec', selectedSpec);
});

// Initial loading of specializations
loadSpec('doc_spec');

// Ensure sub-specializations are loaded initially if a specialization is pre-selected
const initialSelectedSpec = document.getElementById('doc_spec').value;
if (initialSelectedSpec) {
    loadSubSpec('doc_sub_spec', initialSelectedSpec);
}


         
              
            

              function getMaxDate() {
              const today = new Date();
              const maxDate = new Date(today.getFullYear() - 100, today.getMonth(), today.getDate());
              return maxDate.toISOString().split('T')[0];
}
              document.getElementById('doc_photo').addEventListener('change', function(event) {
                  const file = event.target.files[0];
                  if (file) {
                      const reader = new FileReader();
                      reader.onload = function(e) {
                          document.getElementById('displayImage').src = e.target.result;
                      }
                      reader.readAsDataURL(file);
                  }
              });
              document.getElementById('signature').addEventListener('change', function(event) {
                  const file = event.target.files[0];
                  if (file) {
                      const reader = new FileReader();
                      reader.onload = function(e) {
                          document.getElementById('displaySign').src = e.target.result;
                      }
                      reader.readAsDataURL(file);
                  }
              });
          </script>


            <script>
              $(document).ready(function() {



                console.log("Document is ready");
            
                function validateForm(formId, errorDivId) {
                  $(formId).on('submit', function(event) {
                    event.preventDefault();
                    console.log("Form submission prevented");
                    let isValid = true;
                    let errorMessage = '';
            
                    // Reset previous validation states
                    $(this).find('.is-invalid').removeClass('is-invalid');
            
                    const inputs = $(this).find('input, select').toArray().reverse();
                    let formData = {};
            
                    inputs.forEach(function(input) {
                      const $input = $(input);
                      const validationRules = $input.data('validation');
                      const customErrorMessage = $input.data('error-message') || 'This field is required.';
            
                      if (validationRules) {
                        const rules = validationRules.split(' ');
            
                        rules.forEach(rule => {
                          switch (rule) {
                            case 'required':
                              if (!$input.val()) {
                                isValid = false;
                                errorMessage = customErrorMessage;
                                $input.addClass('is-invalid');
                                console.log(`Validation failed: ${customErrorMessage}`);
                              }
                              break;
                            case 'email':
                              const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                              if (!emailRegex.test($input.val())) {
                                isValid = false;
                                errorMessage = customErrorMessage;
                                $input.addClass('is-invalid');
                              }
                              break;
                            // Add more cases here for different validation rules
                          }
                        });
                      }


                      formData[$input.attr('name')] = $input.val();
                    });

                    
                   
            
                    const data =new FormData(this);
                    console.log(data)
                 

                    if (isValid) {
                      $.ajax({
                        url: '/clinic/doctor-info',
                        type: 'POST',
                        data: data,
                        processData: false, 
                        contentType: false,
                        success: function(response) {
                          
                          alert(response.msg);
                          window.location.href = '/clinic/10';
                          $(errorDivId).removeClass('alert-danger').addClass('alert-success').text(response.msg).show();
                          console.log('Response:', response);
                        },
                        error: function(xhr, status, error) {
                          $(errorDivId).removeClass('alert-success').addClass('alert-danger').text(error).show();
                          console.error('Error:', error);
                        }
                      });
                    } else {
                      alert(errorMessage);
                      $(errorDivId).removeClass('alert-success').addClass('alert-danger').text(errorMessage).show();
                    }
                  });
                }
            
                validateForm('#doctorForm', '#errordiv1');
              });
            </script>
                  
        