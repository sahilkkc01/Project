<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>LifeLinkr</title>

<%- include('../header'); -%>
        <!-- //header-ends -->
        <!-- main content start -->
        <div class="main-content">

            <div class="row content-top-gap2">
                <div class="col-lg-12">
                    <nav class="navbar navbar-expand-lg navbar-light bg-white">
                        <a class="navbar-brand text-center mr-5" href="#">
                            <span class="dash-icon"><i class="fas fa-tachometer-alt"></i></span>
                            Dashboard
                        </a>
                        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
                            aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                        <div class="collapse navbar-collapse" id="navbarNav">
                            <ul class="navbar-nav">
                                <li class="nav-item active text-center mr-5">
                                    <a class="nav-link" href="#">
                                        <span class="dash-icon"><i class="far fa-user"></i></span>
                                        Master
                                    </a>
                                </li>
                                <li class="nav-item text-center mr-5">
                                    <a class="nav-link" href="#">
                                        <span class="dash-icon"><i class="fas fa-exchange-alt"></i></span>
                                        Transaction
                                    </a>
                                </li>
                                <li class="nav-item text-center mr-5">
                                    <a class="nav-link" href="#">
                                        <span class="dash-icon"><i class="fas fa-hand-holding-medical"></i></span>
                                        Patient 360
                                    </a>
                                </li>
                                <li class="nav-item text-center mr-5">
                                    <a class="nav-link" href="#">
                                        <span class="dash-icon"><i class="fas fa-receipt"></i></span>
                                        Outside Reciept
                                    </a>
                                </li>
                                <li class="nav-item text-center mr-5">
                                    <a class="nav-link" href="#">
                                        <span class="dash-icon"><i class="fas fa-file-invoice"></i></span>
                                        Outpatient Department
                                    </a>
                                </li>
                                <li class="nav-item text-center mr-5">
                                    <a class="nav-link" href="#">
                                        <span class="dash-icon"><i class="fas fa-chart-line"></i></span>
                                        Analytics
                                    </a>
                                </li>
                                <li class="nav-item text-center mr-5">
                                    <a class="nav-link" href="#">
                                        <span class="dash-icon"><i class="far fa-clock"></i></span>
                                        Waiting List
                                    </a>
                                </li>
                                <li class="nav-item text-center mr-5">
                                    <a class="nav-link" href="#">
                                        <span class="dash-icon"><i class="fas fa-wrench"></i></span>
                                        Adminstration
                                    </a>
                                </li>
                                <li class="nav-item text-center">
                                    <a class="nav-link" href="#">
                                        <span class="dash-icon"><i class="fas fa-spinner"></i></span>
                                        Additional
                                    </a>
                                </li>

                            </ul>
                        </div>
                    </nav>
                </div>
            </div>
            <!-- content -->
            <div class="container-fluid">

                <div class="chart">
                    <div class="row">

                        <div class="col-lg-12 pl-lg-0 mt-2 ml-2">
                            <h4 class="primary">Admin Register</h4>
                        </div>
                        <div class="col-lg-12 pl-lg-2 chart-grid">
                            <div id="errordiv1"></div>
                            <form id="TestCateg" method="post">
                                <input type="hidden" name="query" id="query"  value="0">
                                <div class="card card_border">
                                    <div class="">
                                        <!--Past your code here starts-->

                                        <div class="card">
                                            
                                            <div class="card-body">

                                                <div class="form-row">
                                                    <div class="col-lg-6 col-md-6 col-sm-12">
                                                        <div class="form-group">
                                                            <label class="input__label">User Name</label>
                                                                <input name="username" id='username'type="text" data-validation="required" data-error-message="User Name is required"class="form-control input-style" value='<%- result.username -%>' <%= result.id ? 'disabled' : '' %> >
                                                            </div>
                                                    </div>

                                                    <div class="col-lg-6 col-md-6 col-sm-12">
                                                        <div class="form-group">
                                                            <label class="input__label">Password</label>
                                                                <input name="Password"  id="Password"type="text" class="form-control input-style"  data-validation="required" data-error-message="Password is required" value='<%- result.Password -%>' <%= result.id ? 'disabled' : '' %>  > 
                                                            </div>
                                                    </div>
                                                    <div class="col-lg-4 col-md-6 col-sm-12">
                                                        <div class="form-group">
                                                            <label class="input__label">Clinic Name</label>
                                                                <input name="clinicName"  id="clinicName"type="text" class="form-control input-style"  data-validation="required" data-error-message="Clinic Name is required"  value='<%- result.clinicName -%>' <%= result.id ? 'disabled' : '' %> > 
                                                            </div>
                                                    </div>
                                                    <div class="col-lg-4 col-md-6 col-sm-12">
                                                        <div class="form-group">
                                                            <label class="input__label">Clinic Id</label>
                                                                <input name="clinicId"  id="clinicId"type="text" class="form-control input-style"  data-validation="required" data-error-message="Clinic Id is required"  value='<%- result.clinicId -%>' <%= result.id ? 'disabled' : '' %>> 
                                                            </div>
                                                    </div>

                                                    <div class="col-lg-4 col-md-6 col-sm-12">
                                                        <div class="form-group">
                                                            <label class="input__label">Mobile Number</label>
                                                                <input name="mobileNumber" id='mobileNumber'type="text" data-validation="required" data-error-message="MobileNumber is required"class="form-control input-style" value='<%- result.mobileNumber -%>' <%= result.id ? 'disabled' : '' %>  >
                                                            </div>
                                                    </div>
                                                    <div class="col-lg-4 col-md-6 col-sm-12">
                                                        <div class="form-group">
                                                            <label class="input__label">Created By</label>
                                                                <input name="createdBy" id='createdBy'type="text" data-validation="required" data-error-message="Created By is required"class="form-control input-style" value='<%- result.createdBy -%>' <%= result.id ? 'disabled' : '' %> >
                                                            </div>
                                                    </div>

                                                    <div class="col-lg-2 col-md-6 col-sm-12">
                                                        <div class="form-group">
                                                            <label class="input__label">Issue Admin Rights</label>
                                                            <input name="rights" id='rights' type="checkbox" <%= result.rights ? 'checked' : '' %> <%= result.id ? 'disabled' : '' %>>
                                                            </div>

                                                            <div id="additionalRights" >
                                                                <div class="form-group">
                                                                    <label>
                                                                        <input type="checkbox" name="BillingRights" class="form-checkbox" 
                                                                               <%= (result.rights && result.rights.BillingRights) ? 'checked' : '' %> > Billing Rights
                                                                    </label>
                                                                    <label>
                                                                        <input type="checkbox" name="BillingRightsAdmin" class="form-checkbox" 
                                                                               <%= (result.rights && result.rights.BillingRightsAdmin) ? 'checked' : '' %> > Billing Admin Rights
                                                                    </label>
                                                                </div>
                                                                <div class="form-group">
                                                                    <label>
                                                                        <input type="checkbox" name="InventoryRights" class="form-checkbox" 
                                                                               <%= (result.rights && result.rights.InventoryRights) ? 'checked' : '' %> > Inventory Rights
                                                                    </label>
                                                                    <label>
                                                                        <input type="checkbox" name="InventoryRightsAdmin" class="form-checkbox" 
                                                                               <%= (result.rights && result.rights.InventoryRightsAdmin) ? 'checked' : '' %> > Inventory Admin Rights
                                                                    </label>
                                                                </div>
                                                                <div class="form-group">
                                                                    <label>
                                                                        <input type="checkbox" name="ClinicalRights" class="form-checkbox" 
                                                                               <%= (result.rights && result.rights.ClinicalRights) ? 'checked' : '' %> > Clinical Rights
                                                                    </label>
                                                                    <label>
                                                                        <input type="checkbox" name="ClinicalRightsAdmin" class="form-checkbox" 
                                                                               <%= (result.rights && result.rights.ClinicalRightsAdmin) ? 'checked' : '' %> > Clinical Admin Rights
                                                                    </label>
                                                                </div>
                                                                <div class="form-group">
                                                                    <label>
                                                                        <input type="checkbox" name="radiology" class="form-checkbox" 
                                                                               <%= (result.rights && result.rights.radiology) ? 'checked' : '' %> > Radiology Rights
                                                                    </label>
                                                                </div>
                                                                <div class="form-group">
                                                                    <label>
                                                                        <input type="checkbox" name="pathology" class="form-checkbox" 
                                                                               <%= (result.rights && result.rights.pathology) ? 'checked' : '' %> > Pathology Rights
                                                                    </label>
                                                                </div>
                                                                
                                                                <div class="form-group">
                                                                    <label>
                                                                        <input type="checkbox" name="embrology" class="form-checkbox" 
                                                                               <%= (result.rights && result.rights.embrology) ? 'checked' : '' %> > Embrology Rights
                                                                    </label>
                                                                </div>
                                                            </div>
                                                            
                                                    </div>

                                                    <div class="col-lg-2 col-md-6 col-sm-12">
                                                        <div class="form-group">
                                                            <label class="input__label">Freeze</label>
                                                            <input name="Freeze" id='Freeze' type="checkbox" <%= result.Freeze ? 'checked' : '' %> <%= result.id ? 'disabled' : '' %>>
                                                            </div>
                                                    </div>

                                                
                                                    
                                                    


                                                </div>





                                            </div>
                                        </div>

                                        <!--Past your code here ends-->
                                    </div>
                                </div>
                                <div class="form-group mt-1 mb-3 text-right">

                                    <button type="button" class="btn-success btn-style btn mt-3 mr-2" id="mod-btn" onclick="updateQuery()" ><strong><i
                                                class="fa-regular fa-pen-to-square"></i> Modify</strong></button>

                                    <button type="button" class="btn-secondary btn-style btn mt-3 mr-2" disabled><strong><i
                                                class="fa-solid fa-plus"></i> New</strong></button>

                                    <button type="button" class="btn-danger btn-style btn mt-3 mr-2"  onclick="window.location.href='/Admin/1'"><strong><i
                                                class="fas fa-times"></i> Cancel</strong></button>

                                    <button type="submit"  id='submit'class="btn-primary btn-style btn mt-3"><strong><i
                                                class="far fa-save"></i>
                                            Save</strong></button>

                                </div>
                            </form>
                            <div id="loadingIndicator"></div>
                        </div>
                        <!--footer section start-->
<%- include('../footer'); -%>

<script>
    
    function updateQuery() {
            document.getElementById('query').value = 1;
            $('#mod-btn').prop('disabled', true);   
            $('input[data-validation], select[data-validation], textarea[data-validation],input[type="checkbox"]').prop('disabled', false);
            document.getElementById('submit').disabled = false;
        }

        if ('<%= result.id %>' !== ''&&'<%= result.Freeze %>' == 'true') {
            $('input[data-validation], select[data-validation], textarea[data-validation],input[type="checkbox"]').prop('disabled', true);
            document.getElementById('submit').disabled = true; 
            document.getElementById('mod-btn').disabled = true;

        }
        else if('<%= result.id %>' !== ''&&'<%= result.Freeze %>' !== 'true') {
            $('input[data-validation], select[data-validation], textarea[data-validation],input[type="checkbox"]').prop('disabled', true);
            document.getElementById('submit').disabled = true; 
        }

        if ('<%= result.status %>' !== 'true') {
            document.getElementById('mod-btn').disabled = true;
           
        } 
</script>
    <script type="module">
        import { pagi_search } from '../javascripts/pagi_search.js';
        import { validateForm } from '../javascripts/validation.js';
        import { myAjax } from '../javascripts/myAjax.js';
        $(document).ready(function () {
    // Toggle the display of additional rights based on the 'rights' checkbox
    $('#rights').change(function () {
        if ($(this).is(':checked')) {
            $('#additionalRights').show();
        } else {
            $('#additionalRights').hide();
        }
    });

    $('#TestCateg').on('submit', function (event) {
        event.preventDefault();

        const rightsData = {};
        $('#additionalRights input[type="checkbox"]').each(function() {
            rightsData[this.name] = $(this).is(':checked');
        });

        
        // Serialize form data including dynamic checkboxes
        const formData = new FormData(this);
        formData.append('rightsData', JSON.stringify(rightsData));

        function convertFormDataToJson(formData) {
            const jsonObj = {};
            for (let [key, value] of formData.entries()) {
                if (!jsonObj.hasOwnProperty(key)) {
                    jsonObj[key] = value;
                } else {
                    if (!Array.isArray(jsonObj[key])) {
                        jsonObj[key] = [jsonObj[key]];
                    }
                    jsonObj[key].push(value);
                }
            }



         
            $(formData).find('#Freeze').each(function() {
                jsonObj[this.name] = this.checked; // Set true or false based on the checkbox state
            });

            return jsonObj;
        }

        const jsonFormData = convertFormDataToJson(formData);

        const { isValid, errorMessage } = validateForm('#TestCateg');  // Assume validateForm returns an object with isValid and errorMessage
        const errorDivId = '#errordiv1';

        if (isValid) {
            const loadingDiv = '#loadingIndicator';
            const url = '/Admin/AdminSubmit';

            $.ajax({
                type: 'POST',
                url: url,
                contentType: 'application/json',
                data: JSON.stringify(jsonFormData),
                beforeSend: function() {
                    $(loadingDiv).text('Loading...').show();
                },
                success: function(response) {
                    $(loadingDiv).hide();
                    alert('Form submitted successfully!');
                    $(errorDivId).removeClass('alert-danger').addClass('alert-success').text('Form submitted successfully!').show();
                    console.log('Response:', response);
                },
                error: function(xhr, status, error) {
                    $(loadingDiv).hide();
                    const response = JSON.parse(xhr.responseText);
                    $(errorDivId).removeClass('alert-success').addClass('alert-danger').text(response.msg).show();
                    console.error('Error:', error);
                }
            });
        } else {
            alert(errorMessage);
            $(errorDivId).removeClass('alert-success').addClass('alert-danger').text(errorMessage).show();
        }
    });
});


    </script>