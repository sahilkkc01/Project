<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>LifeLinker</title>

<%- include('../header'); -%>
        <!-- //header-ends -->
        <!-- main content start -->
        <div class="main-content">

            <div class="row content-top-gap2">
                <div class="col-lg-12">
                    <nav class="navbar navbar-expand-lg navbar-light bg-white">
                        <a class="navbar-brand text-center mr-5" href="#">
                            <span class="dash-icon"><i class="fas fa-tachometer-alt"></i></span>
                            Dashboard
                        </a>
                        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
                            aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                        <div class="collapse navbar-collapse" id="navbarNav">
                            <ul class="navbar-nav">
                                <li class="nav-item active text-center mr-5">
                                    <a class="nav-link" href="#">
                                        <span class="dash-icon"><i class="far fa-user"></i></span>
                                        Master
                                    </a>
                                </li>
                                <li class="nav-item text-center mr-5">
                                    <a class="nav-link" href="#">
                                        <span class="dash-icon"><i class="fas fa-exchange-alt"></i></span>
                                        Transaction
                                    </a>
                                </li>
                                <li class="nav-item text-center mr-5">
                                    <a class="nav-link" href="#">
                                        <span class="dash-icon"><i class="fas fa-hand-holding-medical"></i></span>
                                        Patient 360
                                    </a>
                                </li>
                                <li class="nav-item text-center mr-5">
                                    <a class="nav-link" href="#">
                                        <span class="dash-icon"><i class="fas fa-receipt"></i></span>
                                        Outside Reciept
                                    </a>
                                </li>
                                <li class="nav-item text-center mr-5">
                                    <a class="nav-link" href="#">
                                        <span class="dash-icon"><i class="fas fa-file-invoice"></i></span>
                                        Outpatient Department
                                    </a>
                                </li>
                                <li class="nav-item text-center mr-5">
                                    <a class="nav-link" href="#">
                                        <span class="dash-icon"><i class="fas fa-chart-line"></i></span>
                                        Analytics
                                    </a>
                                </li>
                                <li class="nav-item text-center mr-5">
                                    <a class="nav-link" href="#">
                                        <span class="dash-icon"><i class="far fa-clock"></i></span>
                                        Waiting List
                                    </a>
                                </li>
                                <li class="nav-item text-center mr-5">
                                    <a class="nav-link" href="#">
                                        <span class="dash-icon"><i class="fas fa-wrench"></i></span>
                                        Adminstration
                                    </a>
                                </li>
                                <li class="nav-item text-center">
                                    <a class="nav-link" href="#">
                                        <span class="dash-icon"><i class="fas fa-spinner"></i></span>
                                        Additional
                                    </a>
                                </li>

                            </ul>
                        </div>
                    </nav>
                </div>
            </div>
            <!-- content -->
            <div class="container-fluid">

                <div class="chart">
                    <div class="row">

                        <div class="col-lg-12 pl-lg-0 mt-2 ml-2">
                            <h4 class="primary">Pathology Profile Master</h4>
                        </div>
                        <div class="col-lg-12 pl-lg-2 chart-grid">
                            <form id="testForm">
                                <input type="hidden" name="query" value="0" id="query">
                                <input type="hidden" name="itemId" value="<%- a.id -%>" id="itemId">
                                <div class="card card_border">
                                    <div class="card">
                                        <div class="col-xl-12 p-heading">
                                            <h6 class="p-text">PROFILE DETAILS</h6>
                                        </div>
                                        <div class="card-body pl-xl-3 pr-xl-3 pt-2">
                                            <div class="form-row">
                                                <div class="col-lg-12 col-md-12 col-sm-12">
                                                    <div class="form-group">
                                                        <label class="input__label">Service</label>
                                                        <select name="report_generated_by" id="report_generated_by" class="form-control input-style" data-validation="required" data-error-message="Service is required">
                                                            <option>Leutinizing Hormone (LH)</option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="mb-1 mt-4">
                                                <h6 class="primary">LIST OF TESTS</h6>
                                            </div>
                                            <div class="form-row">
                                                <div class="col-6 mb-3">
                                                    <div class="form-group">
                                                        <label class="input__label">Search Test</label>
                                                        <input name="searchTest" id="searchTest" type="text" class="form-control input-style" placeholder="" data-validation="required" data-error-message="Test search is required">
                                                    </div>
                                                </div>
                                               
                                            </div>
                                            <div class="row">
                                                <div class="col col-lg-6">
                                                    <div class="form-row">
                                                        <div class="col-12">
                                                            <div class="slidx">
                                                                <table class="table2" id="ListTest">
                                                                    <thead>
                                                                        <tr>
                                                                            <th width="15%">Status</th>
                                                                            <th class="text-left pl-4">Test</th>
                                                                        </tr>
                                                                    </thead>
                                                                    <tbody>
                                                                        <tr>
                                                                            <td><input class="form-check-input mt-1" type="checkbox" id="gridCheck1"></td>
                                                                            <td class="text-left pl-4">Leutinizing Hormone (LH)</td>
                                                                        </tr>
                                                                        <tr>
                                                                            <td><input class="form-check-input mt-1" type="checkbox" id="gridCheck2"></td>
                                                                            <td class="text-left pl-4">Bleeding Time & Clotting Time</td>
                                                                        </tr>
                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col col-lg-6">
                                                    <div class="form-row">
                                                        <div class="col-12">
                                                            <div class="slidx">
                                                                <table class="table2" id="selectedTest">
                                                                    <thead>
                                                                        <tr>
                                                                            <th width="15%">Status</th>
                                                                            <th class="text-left pl-4">Test</th>
                                                                            <th>Action</th>
                                                                        </tr>
                                                                    </thead>
                                                                    <tbody>
                                                                        <tr <%= a.id ? '' : 'hidden' %> >
                                                                            <td><input class="form-check-input mt-1" type="checkbox" name="status" checked id="selected_${checkboxId}" data-validation="required" data-error-message="Status is required" <%= a.id ? 'disabled' : '' %> ></td>
                                                                            <td class="text-left pl-4" <%= a.id ? 'disabled' : '' %>><%- a.name -%></td>
                                                                            <td><button class="btn btn-danger btn-sm delete-test" data-test-name="${testName}"  <%= a.id ? 'disabled' : '' %>>Delete</button></td>
                                                                        </tr>

                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group mt-1 mb-3 text-right">
                                    <button type="button" class="btn-success btn-style btn  mr-2" id="mod-btn" onclick="updateQuery()"><strong><i
                                        class="fa-regular fa-pen-to-square"></i> Modify</strong></button>
                            
                            <button type="button" class="btn-secondary btn-style btn mr-2" disabled><strong><i
                                        class="fa-solid fa-plus"></i> New</strong></button>
                            
                            <button type="button" class="btn-danger btn-style btn mr-2" onclick="window.location.href='/pathology/25'"><strong><i
                                        class="fas fa-times"></i> Cancel</strong></button>
                            
                            <button type="button" id="submitTests" class="btn-primary btn-style btn"><strong><i class="far fa-save"></i>
                                    Save</strong></button>
                                </div>
                            </form>
                            

                </div>
         <%- include('../footer'); -%>
         <script>
            function updateQuery(){
                document.getElementById('query').value=1;
                $('#mod-btn').prop('disabled', true);   
                $('input[data-validation], select[data-validation] ,textarea[data-validation],.delete-test  ').prop('disabled', false);
            
                document.getElementById('submitTests').disabled = false;
              }
              if('<%= a.id %>'!==''){
                $('input[data-validation], select[data-validation],textarea[data-validation],.delete-test').prop('disabled', true);
            
                
              }else{
               
                document.getElementById('mod-btn').disabled=true;
              }
        </script>
         <script>
            $(document).ready(function() {
                var tests = []; // Initialize the tests array
            
                // Handling checkbox interactions in the list of tests
                $("#ListTest tr").on('click', 'input[type="checkbox"]', function() {
                    var row = $(this).closest('tr');
                    var testName = row.find('td').eq(1).text().trim();
                    var isChecked = $(this).is(':checked');
                    var checkboxId = $(this).attr('id');
            
                    if (isChecked) {
                        // Add test to the selected tests table with a checkbox and delete button
                        $('#selectedTest').append(
                            `<tr>
                                <td><input class="form-check-input mt-1" type="checkbox" name="status" checked id="selected_${checkboxId}" data-validation="required" data-error-message="Status is required"></td>
                                <td class="text-left pl-4">${testName}</td>
                                <td><button class="btn btn-danger btn-sm delete-test" data-test-name="${testName}">Delete</button></td>
                            </tr>`
                        );
                        // Add to the tests array
                        tests.push({
                            name: testName,
                            itemId:'<%- a.id -%>',
                            status: true
                        });
                    } else {
                        // Remove test from the selected tests table if checkbox is unchecked
                        $("#selectedTest tr").each(function() {
                            if ($(this).find('td').eq(1).text().trim() === testName) {
                                $(this).remove();
                            }
                        });
                        // Remove from the tests array
                        tests = tests.filter(test => test.name !== testName);
                    }
                });
            
                // Handling the deletion of a selected test
                $('#selectedTest').on('click', '.delete-test', function() {
                    var row = $(this).closest('tr');
                    var testName = $(this).data('test-name');
                    $("#ListTest tr").each(function() {
                        if ($(this).find('td').eq(1).text().trim() === testName) {
                            $(this).find('input[type="checkbox"]').prop('checked', false);
                        }
                    });
                    row.remove();
                    // Remove from the tests array
                    tests = tests.filter(test => test.name !== testName);
                });
            
                // Submit the selected tests to the backend when the save button is clicked
                $('#submitTests').click(function() {
                    // Use Axios to send the data to the server
                    axios.post('/pathology/pathologyProfileSubmit', { tests: tests })
                        .then(function(response) {
                            console.log('Success:', response.data);
                            alert('Tests submitted successfully!');
                        })
                        .catch(function(error) {
                            console.error('Error:', error);
                            alert('Failed to submit tests.');
                        });
                });
            });
            </script>
            

        