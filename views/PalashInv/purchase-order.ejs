<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>LifeLinkr</title>
    <%-include('../header');-%>
        <!-- main content start -->
        <div class="main-content">

            <div class="row content-top-gap2">
                <div class="col-lg-12">
                    <nav class="navbar navbar-expand-lg navbar-light bg-white">
                        <a class="navbar-brand text-center mr-5" href="#">
                            <span class="dash-icon"><i class="fas fa-tachometer-alt"></i></span>
                            Dashboard
                        </a>
                        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
                            aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                        <div class="collapse navbar-collapse" id="navbarNav">
                            <ul class="navbar-nav">
                                <li class="nav-item active text-center mr-5">
                                    <a class="nav-link" href="#">
                                        <span class="dash-icon"><i class="far fa-user"></i></span>
                                        Master
                                    </a>
                                </li>
                                <li class="nav-item text-center mr-5">
                                    <a class="nav-link" href="#">
                                        <span class="dash-icon"><i class="fas fa-exchange-alt"></i></span>
                                        Transaction
                                    </a>
                                </li>
                                <li class="nav-item text-center mr-5">
                                    <a class="nav-link" href="#">
                                        <span class="dash-icon"><i class="fas fa-hand-holding-medical"></i></span>
                                        Patient 360
                                    </a>
                                </li>
                                <li class="nav-item text-center mr-5">
                                    <a class="nav-link" href="#">
                                        <span class="dash-icon"><i class="fas fa-receipt"></i></span>
                                        Outside Reciept
                                    </a>
                                </li>
                                <li class="nav-item text-center mr-5">
                                    <a class="nav-link" href="#">
                                        <span class="dash-icon"><i class="fas fa-file-invoice"></i></span>
                                        Outpatient Department
                                    </a>
                                </li>
                                <li class="nav-item text-center mr-5">
                                    <a class="nav-link" href="#">
                                        <span class="dash-icon"><i class="fas fa-chart-line"></i></span>
                                        Analytics
                                    </a>
                                </li>
                                <li class="nav-item text-center mr-5">
                                    <a class="nav-link" href="#">
                                        <span class="dash-icon"><i class="far fa-clock"></i></span>
                                        Waiting List
                                    </a>
                                </li>
                                <li class="nav-item text-center mr-5">
                                    <a class="nav-link" href="#">
                                        <span class="dash-icon"><i class="fas fa-wrench"></i></span>
                                        Adminstration
                                    </a>
                                </li>
                                <li class="nav-item text-center">
                                    <a class="nav-link" href="#">
                                        <span class="dash-icon"><i class="fas fa-spinner"></i></span>
                                        Additional
                                    </a>
                                </li>

                            </ul>
                        </div>
                    </nav>
                </div>
            </div>
            <!-- content -->
            <div class="container-fluid">

                <div class="chart">
                    <div class="row">

                        <div class="col-lg-12 pl-lg-0 mt-2 ml-2">
                            <h4 class="primary">Purchase Order</h4>
                        </div>

                        <div class="col-lg-12 pl-lg-2 chart-grid">
                            <form>
                                <div class="card card_border">
                                    <div class="">
                                        <!--Past your code here starts-->

                                        <div class="card">

                                                <!-- <div class="form-group">
                                                    <div class="col-xl-12 p-heading">
                                                        <h6 class="p-text">LIST OF SCRAP SALE</h6>
                                                    </div>
                                                </div> -->

                                            <div class="card-body pb-2 pt-0">

                                                <div class="pl-lg-0 pr-lg-0 mt-2">
                                                    <h6 class="primary">SEARCH PURCHASE ORDER</h6>
                                                </div>
                                                

                                                <div class="form-row">


                                                    <div class="col-lg-3 col-md-4 col-sm-12 mb-2">
                                                        <div class="form-group"><label class="input__label">From
                                                                Date</label><input name="description" type="date"
                                                                class="form-control input-style" placeholder=""></div>
                                                            </div>
                                                            
                                                    <div class="col-lg-3 col-md-4 col-sm-12 mb-2">
                                                        <div class="form-group"><label class="input__label">To
                                                                Date</label><input name="description" type="date"
                                                                class="form-control input-style" placeholder=""></div>
                                                    </div>


                                                    <div class="col-lg-3 col-md-4 col-sm-12 mb-2">
                                                        <div class="form-group"><label class="input__label">Store

                                                        </label><select name="report_generated_by"
                                                                class="form-control input-style">
                                                                <option>Select</option>
                                                            </select></div>
                                                    </div>

                                                    <div class="col-lg-3 col-md-4 col-sm-12 mb-2">
                                                        <div class="form-group"><label class="input__label">Supplier

                                                        </label><select name="report_generated_by"
                                                                class="form-control input-style">
                                                                <option>Select</option>
                                                            </select></div>
                                                    </div>

                                                    <div class="col-lg-3 col-md-4 col-sm-12 mb-2">
                                                        <div class="form-group"><label class="input__label">Purchase Number</label><input name="description" type="text"
                                                                class="form-control input-style" placeholder=""></div>
                                                    </div>


                                                   


                                                    <div class="col-lg-3 col-md-4 col-sm-12">
                                                        <div class="form-check-label" style="display: flex; justify-content: space-between;">
                                                    
                                                            <div class="radio mt-4">
                                                                <label class="form-check-label pt-1"><input class="form-check-input mt-1" type="checkbox">
                                                                    Export To Excel</label>
                                                            </div>
                                                    
                                                    
                                                            <div class="mt-4">
                                                                <button type="button" class="btn-primary btn-style btn btn-change pb-1"><strong><i class="fas fa-search"></i>
                                                                    Search</strong></button>
                                                            </div>
                                                    
                                                    
                                                        </div>
                                                    
                                                    </div>

                                                    

                                                </div>

                                                
                                                
                                                
                                                
                                               
                                               
                                                
                                               
                                                
                                                

                                                
                                            </div>
                                        </div>
                                        
                                        <!--Past your code here ends-->
                                    </div>
                                    
                                    
                                    
                                    

                                </div>


                                <div class="mt-1 col-lg-12 pl-lg-0 pr-lg-0 mt-3">
                                    <div class="card card_border">

                                        <div class="mb-2">
                                            <div class="form-group">
                                                <div class="col-xl-12 p-heading">
                                                    <h6 class="p-text">PO LIST</h6>
                                                </div>
                                            </div>
                                        </div>


                                        <div class="form-row">
                                            <div class="col-12 pl-lg-0 pr-lg-0">
                                                <div class="form-group">
                                                    <div class="col col-12 mb-3 pr-lg-4 pl-lg-4">
                                                        <div class="slidex">

                                                            <table class="table2">

                                                                <thead>
                                                                    <tr>

                                                                        <th contenteditable="true"></th>
                                                                        <th contenteditable="true" style="min-width: 100px;">PO Number</th>
                                                                        <th contenteditable="true" style="min-width: 100px;">PO Date</th>
                                                                        <th contenteditable="true">Supplier Name</th>
                                                                        <th contenteditable="true">GRN No. Date</th>
                                                                        <th contenteditable="true">Purchase Requisition No. - Date</th>
                                                                        <th contenteditable="true">Type</th>
                                                                        <th contenteditable="true">Delivery Location</th>
                                                                        <th contenteditable="true">PO Net Amount</th>
                                                                        <th contenteditable="true">Freeze PO</th>
                                                                        <th contenteditable="true">Approved</th>
                                                                        <th contenteditable="true" >Approve Level 1 Details</th>
                                                                        <th contenteditable="true">Approve Level 1 Details</th>
                                                                        <th contenteditable="true">Cancel PO</th>
                                                                        
                                                                    </tr>
                                                                </thead>

                                                                <tbody id="tbodyid">
                                                                   
                                                                </tbody>
                                                                
                                                            </table>
                                                        </div>


                                                    </div>
                                                </div>
                                            </div>
                                        </div>




                                    </div>
                                </div>



                                <div class="mt-1 col-lg-12 pl-lg-0 pr-lg-0 mt-3">
                                    <div class="card card_border">
                                        <div class="mb-2">
                                            <div class="form-group">
                                                <div class="col-xl-12 p-heading">
                                                    <h6 class="p-text">PO DETAILS</h6>
                                                </div>
                                            </div>
                                        </div>


                                        <div class="form-row">
                                            <div class="col-12  pl-lg-0 pr-lg-0">
                                                <div class="form-group">


                                                    <div class="col col-12 mb-3  pl-lg-4 pr-lg-4">
                                                        <div class="slidex">
                                                            <table class="table2">
                                                                <thead>
                                                                    <tr>
                                                                        
                                                                        
                                                                        <th contenteditable="true">Item Code</th>
                                                                        <th contenteditable="true">Item Name</th>
                                                                        <th contenteditable="true">HSN Code</th>
                                                                        <th contenteditable="true">PO Purchase Quantity</th>
                                                                        <th contenteditable="true">Purchase UOM</th>
                                                                        <th contenteditable="true">Purchase Cost</th>
                                                                        <th contenteditable="true">Cost Amount</th>
                                                                        <th contenteditable="true">MRP</th>
                                                                        <th contenteditable="true">Amount</th>
                                                                        <th contenteditable="true">Discount %</th>
                                                                        <th contenteditable="true">Discount Amount</th>
                                                                        <th contenteditable="true">CGST %</th>
                                                                        <th contenteditable="true">CGST Amount</th>
                                                                        <th contenteditable="true">SGST %</th>
                                                                        <th contenteditable="true">SGST Amount</th>
                                                                        <th contenteditable="true">IGST %</th>
                                                                        <th contenteditable="true">IGST Amount</th>
                                                                        <th contenteditable="true">Net Amount</th>
                                                                        <th contenteditable="true">Specification</th>
                                                                       
                                                                    </tr>
                                                                </thead>
                                                                <tbody id="poDetails">
                                                                  
                                                                </tbody>
                                                            </table>
                                                        </div>

                                                        <div class="row col-12 mt-3">
                                            
                                                            <div class="form-group pr-2">
                                                                <label class="input__label">Total PO</label>
                                        
                                                            </div>
                                        
                                                            <div class="form-group">
                                                                <input name="totalPO" id="totalPO" type="text" class="form-control input-style text-right" placeholder="0">
                                        
                                                            </div>
                                        
                                                        </div>
                                                        


                                                    </div>

                                                </div>
                                            </div>
                                        </div>


                                    </div>
                                </div>



                                <div class="form-group mt-1 mb-3 text-right">

                                    

                                    <button type="button" class="btn-secondary btn-style btn mt-3 mr-2"><strong><i
                                        class="fa-solid fa-print"></i> Print PO</strong></button>

                            <button type="button" onclick=" window.location.href = '/palashinv/37'"  class="btn-secondary btn-style btn mt-3 mr-2"><strong><i
                                        class="fa-solid fa-plus"></i> New</strong></button>

                            <button type="button" class="btn-danger btn-style btn mt-3 mr-2"><strong><i
                                        class="fas fa-times"></i> Cancel</strong></button>

                            <button type="button" disabled class="btn-primary btn-style btn mt-3"><strong><i
                                        class="far fa-save"></i>
                                    Save</strong></button>
                                </div>
                            </form>
                        </div>
                        <!--footer section start-->
                        <%-include('../footer');-%>

                        <script>
                        function fetchPo(){
                                    // Example Axios request to replace the jQuery $.ajax
axios.get('/palashinv/getAllPO')
.then(function(response) {
    console.log(response)
    var count=0;
    const data = response.data;
    // console.log(data)
    let tableRows = '';
    data.forEach(function(item) {
        count=count+1;
        tableRows += `
            <tr data-item-id="${item.id}" onclick="fetchItems(this)"> 
                <td><button type="button" id="view_btn" class="btn btn-primary btn-style btn-change view-btn">View</button></td>
                <td>${item.po_no}</td>
                <td>${item.date}</td>
                <td>${item.supplier}</td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>${item.total_net_amount}</td>
                <td><input type="checkbox" class="freeze-checkbox" data-id='${item.id}' ${item.freeze ? 'checked disabled' : ''}></td>
                <td><input type="checkbox" class="approved-checkbox" disabled data-id='${item.id}' ${item.approved ? 'checked' : ''}></td>
                <td><input  type="text"></td>
                <td><input type="text"></td>
                <td>
              <button type="button" class="btn btn-danger btn-style btn-change cancel-btn" data-id="${item.id}">
                                            <i class="fas fa-times"></i>
                                        </button>
                 </td>
               
            </tr>
        `;
    });

    // Insert rows into the table body
    document.getElementById('tbodyid').innerHTML = tableRows;
    document.getElementById('totalPO').value = count;
 
})
.catch(function(error) {
    console.error('Error fetching data:', error);
});

                            }

                            fetchPo()
//freeze PO
$('#tbodyid').on('change', '.freeze-checkbox', function(event) {
                let requisitionId = $(this).data('id');
                let freezeStatus = $(this).is(':checked');
                updateFreezeStatus('po', requisitionId, freezeStatus);
            });
            $('#tbodyid').on('click', '.cancel-btn', function(event) {
               
                event.stopPropagation(); // Prevent the row click event
                let requisitionId = $(this).data('id');
                cancelPO(requisitionId);
            });
    
            function updateFreezeStatus(type, id, freezeStatus) {
               
                $.ajax({
                    url: `/palashinv/update-freeze-status/${type}/${id}`,
                    type: 'POST',
                    data: JSON.stringify({ freeze: freezeStatus }),
                    contentType: 'application/json',
                    success: function(response) {
                        alert(`${type.charAt(0).toUpperCase() + type.slice(1)} Freezed and Updated Successfully`);
                        console.log(`Freeze status of ${type} ${id} updated successfully`);
                        fetchData(); // Refresh the data
                    },
                    error: function(xhr, status, error) {
                        console.error(`Error updating freeze status for ${type}:`, error);
                    }
                });
            }
    
            function cancelPO(requisitionId) {
                const type='po'
                $.ajax({
                    url: `/palashinv/delete-record/${type}/${requisitionId}/`,
                    type: 'DELETE',
                    success: function(response) {
                        alert('Purchase Order Deleted')
                        fetchData(); 
                    },
                    error: function(xhr, status, error) {
                        console.error('Error deleting requisition:', error);
                    }
                });
            }
    

                            function fetchItems(e) {

// Remove 'locked' class from any previously selected row
const previouslySelected = document.querySelector('.locked');
if (previouslySelected) {
    previouslySelected.classList.remove('locked');
}

// Add 'locked' class to the currently selected row
e.classList.add('locked');

// Get the id of the selected row
const itemId = e.getAttribute('data-item-id');
console.log('Selected Item ID:', itemId);

// Make an Axios GET request to fetch data based on the item ID
axios.get(`/palashinv/getPOItems/${itemId}`)
    .then(function(response) {
        const data = response.data;
        console.log('Fetched Item Data:', data);

        // Clear any previous data in the table body
        const tableBody = document.getElementById('poDetails');
        tableBody.innerHTML = '';

        // Iterate over the fetched data and create rows for the table
        data.forEach(item => {
            const row = `
                <tr>
                    <td>${item.item_code}</td>
                    <td>${item.item_name}</td>
                    <td>${item.hsn_code}</td>
                    <td>${item.purchase_quantity}</td>
                    <td>${item.purchase_uom}</td>
                    <td>${item.purchase_cost_price}</td>
                    <td>${item.cost_amount}</td>
                    <td>${item.mrp}</td>
                    <td>${item.amount}</td>
                    <td>${item.discount_on_sale}%</td>
                    <td>${item.discount_amount}</td>
                    <td>${item.cgst_percent}%</td>
                    <td>${item.cgst_amount}</td>
                    <td>${item.sgst_percent}%</td>
                    <td>${item.sgst_amount}</td>
                    <td>${item.igst_percent}%</td>
                    <td>${item.igst_amount}</td>
                    <td>${item.net_amount}</td>
                    <td>${item.specification || ''}</td>
                </tr>
            `;

            // Append the row to the table body
            tableBody.insertAdjacentHTML('beforeend', row);
        });
    })
    .catch(function(error) {
        console.error('Error fetching item data:', error);
    });
}

                        </script>