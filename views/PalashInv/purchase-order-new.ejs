<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>LifeLinkr</title>
    <%-include('../header');-%>
</head>

<body>
    <!-- main content start -->
    <div class="main-content">
        <div class="row content-top-gap2">
            <div class="col-lg-12">
                <nav class="navbar navbar-expand-lg navbar-light bg-white">
                    <a class="navbar-brand text-center mr-5" href="#">
                        <span class="dash-icon"><i class="fas fa-tachometer-alt"></i></span>
                        Dashboard
                    </a>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
                        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarNav">
                        <ul class="navbar-nav">
                            <li class="nav-item active text-center mr-5">
                                <a class="nav-link" href="#">
                                    <span class="dash-icon"><i class="far fa-user"></i></span>
                                    Master
                                </a>
                            </li>
                            <li class="nav-item text-center mr-5">
                                <a class="nav-link" href="#">
                                    <span class="dash-icon"><i class="fas fa-exchange-alt"></i></span>
                                    Transaction
                                </a>
                            </li>
                            <li class="nav-item text-center mr-5">
                                <a class="nav-link" href="#">
                                    <span class="dash-icon"><i class="fas fa-hand-holding-medical"></i></span>
                                    Patient 360
                                </a>
                            </li>
                            <li class="nav-item text-center mr-5">
                                <a class="nav-link" href="#">
                                    <span class="dash-icon"><i class="fas fa-receipt"></i></span>
                                    Outside Reciept
                                </a>
                            </li>
                            <li class="nav-item text-center mr-5">
                                <a class="nav-link" href="#">
                                    <span class="dash-icon"><i class="fas fa-file-invoice"></i></span>
                                    Outpatient Department
                                </a>
                            </li>
                            <li class="nav-item text-center mr-5">
                                <a class="nav-link" href="#">
                                    <span class="dash-icon"><i class="fas fa-chart-line"></i></span>
                                    Analytics
                                </a>
                            </li>
                            <li class="nav-item text-center mr-5">
                                <a class="nav-link" href="#">
                                    <span class="dash-icon"><i class="far fa-clock"></i></span>
                                    Waiting List
                                </a>
                            </li>
                            <li class="nav-item text-center mr-5">
                                <a class="nav-link" href="#">
                                    <span class="dash-icon"><i class="fas fa-wrench"></i></span>
                                    Adminstration
                                </a>
                            </li>
                            <li class="nav-item text-center">
                                <a class="nav-link" href="#">
                                    <span class="dash-icon"><i class="fas fa-spinner"></i></span>
                                    Additional
                                </a>
                            </li>
                        </ul>
                    </div>
                </nav>
            </div>
        </div>
        <!-- content -->
        <div class="container-fluid">
            <div class="chart">
                <div class="row">
                    <div class="col-lg-12 pl-lg-0 mt-2 ml-2">
                        <h4 class="primary">Purchase Order</h4>
                    </div>
                    <div class="col-lg-12 pl-lg-2 chart-grid">
                        <form>
                            <div class="card card_border">
                                <div class="">
                                    <div class="card">
                                        <div class="card-body pb-2 pt-1">
                                            <div id="errordiv1"></div>
                                            <div class="pl-lg-0 pr-lg-0 mt-2">
                                                <h6 class="primary">PURCHASE ORDER DETAILS</h6>
                                            </div>
                                            <div class="form-row">
                                                <div class="col-lg-3 col-md-4 col-sm-12 mb-2">
                                                    <div class="form-group">
                                                        <label class="input__label">Date</label>
                                                        <input name="date" id="date" type="date" class="form-control input-style"
                                                          readonly  placeholder="">
                                                    </div>
                                                </div>
                                                <div class="col-lg-3 col-md-4 col-sm-12 mb-2">
                                                    <div class="form-group">
                                                        <label class="input__label">Store</label>
                                                        <select name="store" id="store" class="form-control input-style">
                                                            <option value="">Select</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-lg-3 col-md-4 col-sm-12 mb-2">
                                                    <div class="form-group">
                                                        <label class="input__label">Payment Mode</label>
                                                        <select name="payment_mode" id="payment_mode"
                                                            class="form-control input-style">
                                                            <option value="">Select</option>
                                                            <option value="CASH">CASH</option>
                                                            <option value="CHECK">CHEQUE</option>
                                                            <option value="CHECK">CARD</option>
                                                            <option value="UPI">UPI</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-lg-3 col-md-4 col-sm-12 mb-2">
                                                    <div class="form-group">
                                                        <label class="input__label">Supplier</label>
                                                        <select name="supplier" id="supplier"
                                                            class="form-control input-style">
                                                            <option value="">Select</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-lg-3 col-md-4 col-sm-12 mb-2">
                                                    <div class="form-group">
                                                        <label class="input__label">Payment Terms</label>
                                                        <select name="payment_terms" id="payment_terms"
                                                            class="form-control input-style">
                                                            <option value="">Select</option>
                                                            <option value="30">30 DAYS</option>
                                                            <option value="60">60 DAYS</option>
                                                            <option value="120">120 DAYS</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-lg-3 col-md-4 col-sm-12 mb-2">
                                                    <div class="form-group">
                                                        <label class="input__label">Delivery</label>
                                                        <select name="delivery" id="delivery"
                                                            class="form-control input-style">
                                                            <option value="">Select</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-lg-3 col-md-4 col-sm-12 mb-2">
                                                    <div class="form-group">
                                                        <label class="input__label"> Delivery Duration</label>
                                                        <select name="delivery_duration" id="delivery_duration"
                                                            class="form-control input-style">
                                                         
                                                            <option value="">Select</option>
                                                            <option value="30">30 DAYS</option>
                                                            <option value="60">60 DAYS</option>
                                                            <option value="120">120 DAYS</option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="pl-lg-0 pr-lg-0 mt-2">
                                                <h6 class="primary">GET ITEMS</h6>
                                            </div>
                                            <div class="form-row mb-2">
                                                <div class="col-lg-3 col-md-4 col-sm-12 mb-2">
                                                    <div class="form-check-label form-row">
                                                        <div class="radio mt-0">
                                                            <label class="form-check-label pt-1 pr-4"><input
                                                                    class="form-check-input mt-1" type="radio"
                                                                    name="itemSearchType"
                                                                    value="requisition">Against Purchase
                                                                Requisition</label>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-lg-1 col-md-2 col-sm-12">
                                                    <div class="form-group"><button type="button" id="addPr"
                                                            data-toggle="modal" data-target="#purchaseRequisitionModal"
                                                            class="btn btn-style btn-secondary btn-style btn-change"><strong>Get
                                                                PR</strong></button></div>
                                                </div>
                                                <div class="col-lg-1 col-md-2 col-sm-12 mb-2">
                                                    <div class="form-check-label form-row">
                                                        <div class="radio mt-0">
                                                            <label class="form-check-label pt-1 pr-4"><input
                                                                    class="form-check-input mt-1" type="radio"
                                                                    name="itemSearchType" value="direct">Direct</label>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-lg-1 col-md-2 col-sm-12">
                                                    <div class="form-group"><button type="button" id="addItems"
                                                            data-toggle="modal" data-target="#itemSearchModal"
                                                            class="btn btn-style btn-secondary btn-style btn-change"><strong>Get
                                                                Items</strong></button></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-1 col-lg-12 pl-lg-0 pr-lg-0 mt-3">
                                    <div class="card card_border">
                                        <!-- Item div -->
                                        <div class="form-row  mt-3" id="item_div">
                                            <div class="col-12  pl-lg-0 pr-lg-0">
                                                <div class="form-group">
                                                    <div class="col col-12 mb-3 pr-lg-4 pl-lg-4">
                                                        <div class="slidex">
                                                            <table class="table2" id="maintblid">
                                                                <thead>
                                                                    <tr>
                                                                        <th contenteditable="true">Contract</th>
                                                                        <th contenteditable="true">Item Code</th>
                                                                        <th contenteditable="true">Item Name</th>
                                                                        <th contenteditable="true" class="prth">PR Quantity</th>
                                                                        <th contenteditable="true" class="prth">UOM</th>
                                                                        <th contenteditable="true" class="prth">PR Pending Quantity</th>
                                                                        <th contenteditable="true">UOM</th>
                                                                        <th contenteditable="true">Purchase Quantity
                                                                        </th>
                                                                        <th contenteditable="true">Transaction UOM
                                                                        </th>
                                                                        <th contenteditable="true">Stock UOM</th>
                                                                        <th contenteditable="true">Purchase Cost Price
                                                                        </th>
                                                                        <th contenteditable="true">Cost Amount</th>
                                                                        <th contenteditable="true">M.R.P</th>
                                                                        <th contenteditable="true">Amount</th>
                                                                        <th contenteditable="true">Available Stock
                                                                        </th>
                                                                        <th contenteditable="true">Discount %</th>
                                                                        <th contenteditable="true">Discount Amount</th>
                                                                        
                                                                        <th contenteditable="true">CGST %</th>
                                                                        <th contenteditable="true">CGST Amount</th>
                                                                        <th contenteditable="true">SGST%</th>
                                                                        <th contenteditable="true">SGST Amount</th>
                                                                        <th contenteditable="true">IGST %</th>
                                                                        <th contenteditable="true">IGST Amount</th>
                                                                        <th contenteditable="true">Net Amount</th>
                                                                        <th contenteditable="true">Specification</th>
                                                                        <th contenteditable="true">HSN Code</th>
                                                                        <th contenteditable="true"></th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody id="main-table-body">
                                                                    <!-- Rows will be inserted here -->
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-row card-body pt-0 pb-2">
                                            <!-- Guarantee-Warranty -->
                                            <div class="col-lg-3 col-md-4 col-sm-12 mb-2">
                                                <div class="form-group">
                                                    <label class="input__label">Guarantee-Warranty</label>
                                                    <input name="guarantee_warranty" type="text" class="form-control input-style " >
                                                </div>
                                            </div>
                                            <!-- Schedule -->
                                            <div class="col-lg-3 col-md-4 col-sm-12 mb-2">
                                                <div class="form-group">
                                                    <label class="input__label">Schedule</label>
                                                    <select name="schedule" class="form-control input-style">
                                                        <option value="">Select</option>
                                                        <option value="Schedule 1">Schedule 1</option>
                                                        <option value="Schedule 2">Schedule 2</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <!-- Instructions -->
                                            <div class="col-lg-3 col-md-4 col-sm-12 mb-2">
                                                <div class="form-group">
                                                    <label class="input__label">Instructions</label>
                                                    <select name="instructions" class="form-control input-style">
                                                        <option value="">Select</option>
                                                        <option value="1">100% Payment post Delivery and installation</option>
                                                        <option value="2">Payment Terms: Withing 30 days from date of submission of bill</option>
                                                        <option value="3">Price : Inclusive of GST and all other charges</option>
                                                        <option value="4">Taxes Applicable as state above</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <!-- Gross Amount -->
                                            <div class="col-lg-3 col-md-4 col-sm-12 mb-2">
                                                <div class="form-group">
                                                    <label class="input__label">Gross Amount</label>
                                                    <input name="gross_amount" type="text" class="form-control input-style text-right" placeholder="0.00" readonly>
                                                </div>
                                            </div>
                                            <!-- Total CGST -->
                                            <div class="col-lg-3 col-md-4 col-sm-12 mb-2">
                                                <div class="form-group">
                                                    <label class="input__label">Total CGST</label>
                                                    <input name="total_cgst" type="text" class="form-control input-style text-right" placeholder="0.00" readonly>
                                                </div>
                                            </div>
                                            <!-- Total SGST -->
                                            <div class="col-lg-3 col-md-4 col-sm-12 mb-2">
                                                <div class="form-group">
                                                    <label class="input__label">Total SGST</label>
                                                    <input name="total_sgst" type="text" class="form-control input-style text-right" placeholder="0.00" readonly>
                                                </div>
                                            </div>
                                            <!-- Total IGST -->
                                            <div class="col-lg-3 col-md-4 col-sm-12 mb-2">
                                                <div class="form-group">
                                                    <label class="input__label">Total IGST</label>
                                                    <input name="total_igst" type="text" class="form-control input-style text-right" placeholder="0.00" readonly>
                                                </div>
                                            </div>
                                            <!-- Other Charges -->
                                            <div class="col-lg-3 col-md-4 col-sm-12 mb-2">
                                                <div class="form-group">
                                                    <label class="input__label">Other Charges</label>
                                                    <input name="other_charges" type="text" class="form-control input-style text-right" placeholder="0.00">
                                                </div>
                                            </div>
                                            <!-- Total Discount -->
                                            <div class="col-lg-3 col-md-4 col-sm-12 mb-2">
                                                <div class="form-group">
                                                    <label class="input__label">Total Discount</label>
                                                    <input name="total_discount" type="number" class="form-control input-style text-right" placeholder="0.00" readonly>
                                                </div>
                                            </div>
                                            <div class="col-lg-3 col-md-4 col-sm-12 mb-2">
                                                <div class="form-group">
                                                    <label class="input__label">PO Discount</label>
                                                    <input name="po_discount" id="po_discount" type="number" class="form-control input-style text-right" placeholder="0.00">
                                                </div>
                                            </div>
                                            <!-- Total Net Amount -->
                                            <div class="col-lg-3 col-md-4 col-sm-12 mb-2">
                                                <div class="form-group">
                                                    <label class="input__label">Total Net Amount</label>
                                                    <input name="total_net_amount" type="text" class="form-control input-style text-right" placeholder="0.00" readonly>
                                                </div>
                                            </div>
                                            <!-- Remarks -->
                                            <div class="col-lg-3 col-md-4 col-sm-12 mb-2">
                                                <div class="form-group">
                                                    <label class="input__label">Remarks</label>
                                                    <textarea name="remarks" class="form-control input-style" placeholder=""></textarea>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        
                                        
                                    </div>
                                </div>

                                <div class="form-group mt-1 mb-3 text-right">
                                    <button type="button" disabled class="btn-secondary btn-style btn mt-3 mr-2"><strong><i
                                            class="fa-solid fa-print"></i> Print PO</strong></button>
                                    <button type="button" disabled class="btn-secondary btn-style btn mt-3 mr-2"><strong><i
                                            class="fa-solid fa-plus"></i> New</strong></button>
                                    <button type="button" onclick=" window.location.href = '/palashinv/36'"
                                        class="btn-danger btn-style btn mt-3 mr-2"><strong><i
                                            class="fas fa-times"></i> Cancel</strong></button>
                                    <button type="button" class="btn-primary btn-style btn mt-3" id="saveFormBtn"><strong><i
                                            class="far fa-save"></i> Save</strong></button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="itemSearchModal">
            <div class="modal-dialog modal-xl">
                <div class="modal-content">

                    <!-- Modal Header -->
                    <div class="modal-header">
                        <h4 class="modal-title">Item Search</h4>
                        <button type="button" class="close" data-dismiss="modal">&times;"></button>
                    </div>

                    <!-- Modal body -->
                    <div class="modal-body">
                        <form>
                            <div class="card card_border mt-3">
                                <div class="card">
                                    <div class="col-xl-12 p-heading">
                                        <h6 class="p-text">ITEM SEARCH</h6>
                                    </div>
                                    <div class="form-row card-body pb-3 pt-2">
                                        <div class="col-lg-3 col-md-4 col-sm-12">
                                            <div class="form-group">
                                                <label class="input__label">Item Name</label>
                                                <input name="service name" type="text"
                                                    class="form-control input-style" placeholder="">
                                            </div>
                                        </div>
                                        <div class="col-lg-3 col-md-4 col-sm-12">
                                            <div class="form-group">
                                                <label class="input__label">Brand Name</label>
                                                <input name="service name" type="text"
                                                    class="form-control input-style" placeholder="">
                                            </div>
                                        </div>
                                        <div class="col-lg-3 col-md-4 col-sm-12">
                                            <div class="form-group">
                                                <label class="input__label">Item Code</label>
                                                <input name="service name" type="number"
                                                    class="form-control input-style" placeholder="">
                                            </div>
                                        </div>
                                        <div class="col-lg-3 col-md-4 col-sm-12">
                                            <div class="form-group">
                                                <label class="input__label">Item Category</label>
                                                <select name="report_generated_by" class="form-control input-style">
                                                    <option>Select</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-lg-3 col-md-4 col-sm-12">
                                            <div class="form-group">
                                                <label class="input__label">Item Group</label>
                                                <select name="report_generated_by" class="form-control input-style">
                                                    <option>Select</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-lg-3 col-md-4 col-sm-12">
                                            <div class="form-group">
                                                <label class="input__label">Molecule</label>
                                                <select name="report_generated_by" class="form-control input-style">
                                                    <option>Select</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-lg-3 col-md-4 col-sm-12">
                                            <div class="form-group">
                                                <label class="input__label">Store</label>
                                                <select name="report_generated_by" class="form-control input-style">
                                                    <option>Select</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-lg-3 col-md-4 col-sm-12 text-left">
                                            <div class="form-group">
                                                <button type="button"
                                                    class="btn btn-style mt-4 btn-primary btn-style btn-change">
                                                    <strong><i class="fas fa-search"></i> Search</strong>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card card_border mt-3">
                                <div class="col-lg-12 col-md-12 col-sm-12">
                                    <div class="form-check-label">
                                        <div class="radio mt-2 mb-2">
                                            <label class="form-check-label pt-1">
                                                <input class="form-check-input mt-1" type="checkbox"
                                                    id="select-all-items">
                                                Select All Items
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-row card-body pt-1 pb-3">
                                    <div class="col-12 mb-0">
                                        <div class="form-group">
                                            <div class="col col-12 pr-xl-0 pl-xl-0">
                                                <div class="slidx">
                                                    <table class="table2">
                                                        <thead>
                                                            <tr>
                                                                <th contenteditable="true">Select</th>
                                                                <th contenteditable="true">Item Code</th>
                                                                <th contenteditable="true">Item Name</th>
                                                                <th contenteditable="true">Brand Name</th>
                                                                <th contenteditable="true">CGST</th>
                                                                <th contenteditable="true">SGST</th>
                                                                <th contenteditable="true">IGST</th>
                                                                <th contenteditable="true">Suspend</th>
                                                                <th contenteditable="true">Available Stock</th>
                                                                <th contenteditable="true">Stock UOM</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody id="tbodyid">
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group mt-1 mb-3 text-right">
                                <button type="button" class="btn-danger btn-style btn mt-3 mr-2"
                                    data-dismiss="modal">
                                    <strong><i class="fas fa-times"></i> Cancel</strong>
                                </button>
                                <button type="button" class="btn-primary btn-style btn mt-3"
                                    data-dismiss="modal" id="addSelectedItemsBtn">
                                    <strong><i class="fas fa-check"></i> OK</strong>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal Structure -->
<div class="modal fade" id="purchaseRequisitionModal">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title">Purchase Requisition Search</h4>
                <button type="button" class="close" data-dismiss="modal">&times;"></button>
            </div>

            <!-- Modal Body -->
            <div class="modal-body">
                <form>
                    <div class="card card_border">
                        <div class="card-body pb-2 pt-2">
                            <div class="form-row">
                                <div class="col-lg-3 col-md-4 col-sm-12 mb-2">
                                    <div class="form-group"><label class="input__label">Purchase Requisition Number</label><input name="description" type="text" class="form-control input-style" placeholder="">
                                    </div>
                                </div>

                                <div class="col-lg-3 col-md-4 col-sm-12 mb-2">
                                    <div class="form-group"><label class="input__label">From Store</label><select name="report_generated_by" class="form-control input-style">
                                            <option>Select</option>
                                        </select></div>
                                </div>

                                <div class="col-lg-3 col-md-4 col-sm-12 mb-2">
                                    <div class="form-group"><label class="input__label">To Store</label><select name="report_generated_by" class="form-control input-style">
                                            <option>Select</option>
                                        </select></div>
                                </div>

                                <div class="col-lg-3 col-md-4 col-sm-12 mb-2">
                                    <div class="form-group"><label class="input__label">From Date</label><input name="description" type="date" class="form-control input-style" placeholder="">
                                    </div>
                                </div>

                                <div class="col-lg-3 col-md-4 col-sm-12 mb-2">
                                    <div class="form-group"><label class="input__label">To Date </label><input name="description" type="date" class="form-control input-style" placeholder="">
                                    </div>
                                </div>

                                <div class="col-lg-3 col-md-4 col-sm-12 mb-2">
                                    <div class="form-group"><label class="input__label">Item Name</label><input name="description" type="text" class="form-control input-style" placeholder=""></div>
                                </div>

                                <div class="col-lg-3 col-md-4 col-sm-12 mb-2">
                                    <div class="form-group"><label class="input__label">Supplier</label><select name="report_generated_by" class="form-control input-style">
                                            <option>Select</option>
                                        </select></div>
                                </div>

                                <div class="col-lg-3 col-md-4 col-sm-12">
                                    <div class="form-group"><button type="button" class="btn btn-style mt-4 btn-primary btn-style btn-change"><strong><i class="fas fa-search"></i> Search</strong></button></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card card_border mt-3">
                        <div class="mb-2">
                            <div class="form-group">
                                <div class="col-xl-12 p-heading">
                                    <h6 class="p-text">PURCHASE REQUISITION LIST</h6>
                                </div>
                            </div>
                        </div>

                        <div class="col-12 pr-lg-4 pl-lg-4">
                            <div class="form-check-label form-row">
                                <div class="radio">
                                    <input class="form-check-input mt-1" type="checkbox" id="select-all-items">
                                                            Select All Items
                                </div>
                            </div>
                        </div>

                        <div class="form-row mt-3">
                            <div class="col-12 pl-lg-0 pr-lg-0">
                                <div class="form-group">
                                    <div class="col col-12 mb-3 pr-lg-4 pl-lg-4">
                                        <div class="slidx">
                                            <table class="table2">
                                                <thead>
                                                    <tr>
                                                        <th>Select</th>
                                                        <th>Purchase Requisition Number</th>
                                                        <th>Purchase Requisition Date</th>
                                                        <th>Item Code</th>
                                                        <th>Item Name</th>
                                                        <th>Supplier</th>
                                                        <th>Purchase Requisition Quantity</th>
                                                        <th>UOM</th>
                                                        <th>Pending Quantity</th>
                                                        <th>Base UOM</th>
                                                        <th>Final Pending Qty</th>
                                                        <th>UOM</th>
                                                        <th>Available Stock</th>
                                                        <th>Stock UOM</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="pritemsbody">
                                                   
                                                 
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>


                    <div class="form-group mt-1 mb-3 text-right">
                        <button type="button" class="btn-danger btn-style btn mt-3 mr-2" data-dismiss="modal"><strong><i class="fas fa-times"></i> Cancel</strong></button>
                        <button type="button"  class="btn-primary btn-style btn mt-3" data-dismiss="modal" id="addSelectedPRItemsBtn"><strong><i class="fas fa-check"></i> OK</strong></button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

        <!--footer section start-->
        <%-include('../footer');-%>

        <script>

            

function setDateToToday() {
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('date').value = today;
}

// Call the function on page load
setDateToToday();
            // Function to load dropdown options
            const loadDropdown = (url, elementId) => {
                fetch(url)
                    .then(response => response.json())
                    .then(data => {
                        const dropdown = document.getElementById(elementId);
                        data.forEach(item => {
                            const option = document.createElement('option');
                            option.value = item.code || item.rank_desc || item.shelf_desc || item.bin_desc || item.clinic_desc || item.tax_desc;
                            option.textContent = item.description || item.rank_desc || item.shelf_desc || item.bin_desc || item.clinic_desc || item.tax_desc;
                            dropdown.appendChild(option);
                        });
                    })
                    .catch(error => console.error(`Error fetching ${elementId} details:`, error));
            };
        
            // Load dropdowns
            const loadStoreDropdown = () => {
    const url = '/adminInv/get-store-details';
    const elementId = 'store';

    fetch(url)
        .then(response => response.json())
        .then(data => {
            const dropdown = document.getElementById(elementId);
             // Clear existing options

            data.forEach(item => {
                const option = document.createElement('option');
                option.value = item.description; // Assuming `code` is the unique identifier for store
                option.textContent = item.description; // Assuming `description` is the display text
                dropdown.appendChild(option);
            });
        })
        .catch(error => console.error('Error fetching store details:', error));
};

// Call the function to load the store dropdown
loadStoreDropdown();

           
            loadDropdown('/adminInv/get-supplier-details', 'supplier');
            loadDropdown('/adminInv/get-supplier-details', 'delivery');


           
            

            // Function to fetch and populate purchase requisition items
            let fetchedPRItems = {}; // Global variable to store fetched PR items

// Function to fetch and populate purchase requisition items
function fetchPurchaseRequisitionItems(supplier, store) {
    $.ajax({
        url: '/palashinv/getprdata', // Replace with your actual route
        type: 'GET',
        data: { 
            supplierCode: supplier,
            store: store
        },
        success: function (response) {
            console.log(response);
            let tableRows = '';

            let supp_name = document.getElementById('supplier');
            const selectedOption = supp_name.options[supp_name.selectedIndex];
            const selectedSupplierName = selectedOption.text;

            // Store the response in the global variable
            fetchedPRItems = response.reduce((acc, requisition) => {
                requisition.items.forEach(item => {
                    acc[item.itemDetail.itemMaster.item_code] = item; // Store item data by item_code
                });
                return acc;
            }, {});

            // Loop through each requisition and its items to generate the table rows
            response.forEach(function (requisition) {
                requisition.items.forEach(function (item) {
                    tableRows += `
                        <tr data-item-id="${item.itemDetail.itemMaster.item_code}">
                            <td><input class="form-check-input mt-0 pr-item-checkbox" type="checkbox"></td>
                            <td>${item.requisition.requisition_no}</td>
                            <td>${new Date(item.requisition.requisition_date).toLocaleDateString()}</td>
                            <td>${item.itemDetail.itemMaster.item_code}</td>
                            <td>${item.itemDetail.itemMaster.item_name}</td>
                            <td>${selectedSupplierName}</td>
                            <td>${item.requisition_quantity}</td>
                            <td>${item.itemDetail.itemMaster.purchase_uom || 'N/A'}</td>
                            <td>${item.pending_quantity || 'N/A'}</td>
                            <td>${item.itemDetail.itemMaster.base_uom || 'N/A'}</td>
                            <td>${item.pending_quantity || 'N/A'}</td>
                            <td>${item.itemDetail.itemMaster.selling_uom || 'N/A'}</td>
                            <td>${item.itemDetail.availableStock || 'N/A'}</td>
                            <td>${item.itemDetail.itemMaster.stocking_uom || 'N/A'}</td>
                            <td style="display:none;">${item.itemDetail.itemConv.conversion_factor}</td>
                            <td style="display:none;">${item.itemDetail.itemMaster.base_unit_cost_price}</td>
                            <td style="display:none;">${item.itemDetail.itemMaster.base_unit_mrp}</td>
                            <td style="display:none;">${item.itemDetail.itemMaster.discount_on_sale}</td>
                            <td style="display:none;">${item.itemDetail.itemStoreTax.CGST}</td>
                            <td style="display:none;">${item.itemDetail.itemStoreTax.SGST}</td>
                            <td style="display:none;">${item.itemDetail.itemStoreTax.IGST}</td>
                            <td style="display:none;">${item.itemDetail.itemMaster.hsn_codes}</td>
                        </tr>
                    `;
                });
            });

            // Insert table rows into the table body
            $('#pritemsbody').html(tableRows);
        },
        error: function (xhr, status, error) {
            console.error('Error fetching requisition items:', error);
        }
    });
}

// Function to add selected items from PR modal to the main table
// Function to add selected items from PR modal to the main table
function addSelectedPRItemsToMainTable() {
    // Iterate over each checked item in the PR items body
    $('#pritemsbody input.pr-item-checkbox:checked').each(function () {
        const row = $(this).closest('tr');
        const requisitionNumber = row.find('td:eq(1)').text();
        const requisitionDate = row.find('td:eq(2)').text();
        const itemCode = row.find('td:eq(3)').text();
        const itemName = row.find('td:eq(4)').text();
        const supplierName = row.find('td:eq(5)').text();
        const requisitionQuantity = row.find('td:eq(6)').text();
        const uom = row.find('td:eq(7)').text();
        const prPendingQuantity = row.find('td:eq(8)').text();
        const baseUom = row.find('td:eq(9)').text();
        const availableStock = row.find('td:eq(12)').text();
        const stockUom = row.find('td:eq(13)').text();
        const conversion_factor = row.find('td:eq(14)').text();
        const base_unit_cost_price = row.find('td:eq(15)').text();
        const base_unit_mrp = row.find('td:eq(16)').text();
        const discount_on_sale = row.find('td:eq(17)').text();
        const CGST = row.find('td:eq(18)').text();
        const SGST = row.find('td:eq(19)').text();
        const IGST = row.find('td:eq(20)').text();
        const hsnCode = row.find('td:eq(21)').text();

        const pur_cost_price = base_unit_cost_price * conversion_factor;
        const pur_mrp_price = base_unit_mrp * conversion_factor;

        // Create a new row with the fetched and selected details
        const newRow = `
            <tr data-item-id="${itemCode}">
                <td><input type="text" name="requisition_number" class="form-control input-style" value="${requisitionNumber}" readonly></td>
                <td><input type="text" name="item_code" class="form-control input-style" value="${itemCode}" readonly></td>
                <td><input type="text" name="item_name" class="form-control input-style" value="${itemName}" readonly></td>
                <td><input type="number" name="pr_quantity" class="form-control input-style" value="${requisitionQuantity}" readonly></td>
                <td><input type="text" name="uom" class="form-control input-style" value="${uom}" readonly></td>
                <td><input type="number" name="pr_pending_quantity" class="form-control input-style" value="${prPendingQuantity}" readonly></td>
                <td><input type="text" name="purchase_uom" class="form-control input-style" value="${baseUom}" readonly></td>
                <td><input type="number" name="purchase_quantity" class="form-control input-style"></td>
                <td>
                    <select name="uom_select" class="form-control input-style">
                        <option value="${uom}">${uom}</option>
                        <option value="${stockUom}">${stockUom}</option>
                    </select>
                </td>
                <td><input type="text" name="stocking_uom" class="form-control input-style" value="${stockUom}" readonly></td>
                <td><input type="number" name="purchase_cost_price" class="form-control input-style" value="${pur_cost_price}" readonly></td>
                <td><input type="number" name="cost_amount" class="form-control input-style" readonly></td>
                <td><input type="number" name="mrp" class="form-control input-style" value="${pur_mrp_price}" readonly></td>
                <td><input type="number" name="amount" class="form-control input-style" readonly></td>
                <td><input type="number" name="available_stock" class="form-control input-style" value="${availableStock}" readonly></td>
                <td><input type="number" name="discount_percent" class="form-control input-style" value="${discount_on_sale}"></td>
                <td><input type="number" name="discount_amount" class="form-control input-style" readonly></td>
                <td><input type="number" name="cgst_percent" class="form-control input-style" value="${CGST}"></td>
                <td><input type="number" name="cgst_amount" class="form-control input-style" readonly></td>
                <td><input type="number" name="sgst_percent" class="form-control input-style" value="${SGST}"></td>
                <td><input type="number" name="sgst_amount" class="form-control input-style" readonly></td>
                <td><input type="number" name="igst_percent" class="form-control input-style" value="${IGST}"></td>
                <td><input type="number" name="igst_amount" class="form-control input-style" readonly></td>
                <td><input type="number" name="net_amount" class="form-control input-style" readonly></td>
                <td><input type="text" name="specification" class="form-control input-style"></td>
                <td><input type="text" name="hsn_code" class="form-control input-style" value="${hsnCode}" readonly></td>
                <td><button type="button" class="btn btn-danger btn-sm remove-item"><i class="fa-solid fa-trash-can"></i></button></td>
            </tr>
        `;

        // Append the new row to the main table body
        $('#main-table-body').append(newRow);
    });
}


// Bind the function to the "OK" button in the PR modal
$('#addSelectedPRItemsBtn').on('click', addSelectedPRItemsToMainTable);

function calculatePRRowAmounts(row) {
    let purchaseQuantity = parseFloat(row.find('input[name="purchase_quantity"]').val()) || 0;
    let purchaseCostPrice = parseFloat(row.find('input[name="purchase_cost_price"]').val()) || 0;
    let mrp = parseFloat(row.find('input[name="mrp"]').val()) || 0;
    let discountOnSale = parseFloat(row.find('input[name="discount_percent"]').val()) || 0;
    let cgstPercent = parseFloat(row.find('input[name="cgst_percent"]').val()) || 0;
    let sgstPercent = parseFloat(row.find('input[name="sgst_percent"]').val()) || 0;
    let igstPercent = parseFloat(row.find('input[name="igst_percent"]').val()) || 0;

    // Calculating Cost Amount = Purchase Cost Price * Purchase Quantity
    let costAmount = purchaseCostPrice * purchaseQuantity;

    // Calculating Amount = MRP * Purchase Quantity
    let amount = mrp * purchaseQuantity;

    // Calculating discount amount
    let discountAmount = (amount * discountOnSale) / 100;

    // Adjusting amount after discount
    let amountAfterDiscount = amount - discountAmount;

    // Calculating CGST, SGST, IGST Amounts on amount after discount
    let cgstAmount = (amountAfterDiscount * cgstPercent) / 100;
    let sgstAmount = (amountAfterDiscount * sgstPercent) / 100;
    let igstAmount = (amountAfterDiscount * igstPercent) / 100;

    // Calculating Net Amount = Amount after discount + CGST Amount + SGST Amount + IGST Amount
    let netAmount = amountAfterDiscount + cgstAmount + sgstAmount + igstAmount;

    // Updating the row with the calculated values
    row.find('input[name="cost_amount"]').val(costAmount.toFixed(2));
    row.find('input[name="amount"]').val(amount.toFixed(2));
    row.find('input[name="discount_amount"]').val(discountAmount.toFixed(2));
    row.find('input[name="cgst_amount"]').val(cgstAmount.toFixed(2));
    row.find('input[name="sgst_amount"]').val(sgstAmount.toFixed(2));
    row.find('input[name="igst_amount"]').val(igstAmount.toFixed(2));
    row.find('input[name="net_amount"]').val(netAmount.toFixed(2));
}
function calculatePRTotals() {
    let totalCgst = 0;
    let totalSgst = 0;
    let totalIgst = 0;
    let totalDiscount = 0;
    let totalNetAmount = 0;

    // Calculate totals based on each row in the main table
    $('#main-table-body tr').each(function () {
        let row = $(this);
        totalCgst += parseFloat(row.find('input[name="cgst_amount"]').val()) || 0;
        totalSgst += parseFloat(row.find('input[name="sgst_amount"]').val()) || 0;
        totalIgst += parseFloat(row.find('input[name="igst_amount"]').val()) || 0;
        totalDiscount += parseFloat(row.find('input[name="discount_amount"]').val()) || 0;
        totalNetAmount += parseFloat(row.find('input[name="net_amount"]').val()) || 0;
    });

    // Display the totals in the respective fields
    $('input[name="total_cgst"]').val(totalCgst.toFixed(2));
    $('input[name="total_sgst"]').val(totalSgst.toFixed(2));
    $('input[name="total_igst"]').val(totalIgst.toFixed(2));
    $('input[name="total_discount"]').val(totalDiscount.toFixed(2));

    // Gross amount is the initial total net amount before applying other charges and PO discount
    $('input[name="gross_amount"]').val(totalNetAmount.toFixed(2));

    // Apply Other Charges if any
    let otherCharges = parseFloat($('input[name="other_charges"]').val()) || 0;
    totalNetAmount += otherCharges;

    // Apply PO Discount if any
    let poDiscount = parseFloat($('input[name="po_discount"]').val()) || 0;
    totalNetAmount -= poDiscount;

    // Display the final Total Net Amount
    $('input[name="total_net_amount"]').val(totalNetAmount.toFixed(2));
}


// Call this function when you want to fetch and display PR items
$('#addPr').click(function (e) {
    const supplier= $('#supplier').val();
    const store= $('#store').val();
    if (!supplier || supplier === 'Select' && !store || store === 'Select' ) {
                    alert('Please select Both Supplier and Store');
                    e.preventDefault(); // Prevent the default action of opening the modal
                    e.stopPropagation(); // Stop the event from bubbling up
                    return;
                }
    fetchPurchaseRequisitionItems(supplier,store);

});

// Handle adding selected PR items to the main table
$('#addSelectedItemsBtn').on('click', function () {
    $('#pritemsbody input.pr-item-checkbox:checked').each(function () {
        const row = $(this).closest('tr');
        const requisitionNumber = row.find('td:eq(1)').text();
        const requisitionDate = row.find('td:eq(2)').text();
        const itemCode = row.find('td:eq(3)').text();
        const itemName = row.find('td:eq(4)').text();
        const supplierName = row.find('td:eq(5)').text();
        const requisitionQuantity = row.find('td:eq(6)').text();

        const newRow = `
            <tr>
                <td>${requisitionNumber}</td>
                <td>${itemCode}</td>
                <td>${itemName}</td>
                <td><input type="number" name="requisition_quantity" class="form-control input-style" value="${requisitionQuantity}" readonly></td>
                <td>${supplierName}</td>
                <td>${requisitionDate}</td>
                <td><button type="button" class="btn btn-danger btn-sm remove-item"><i class="fa-solid fa-trash-can"></i></button></td>
            </tr>
        `;

        $('#main-table-body').append(newRow);
    });
});

        
            // Fetch data based on store
            function fetchData(from_store) {
                $.ajax({
                    url: '/palashinv/get-current-item-counts',
                    type: 'GET',
                    data: {
                        store: from_store,
                        clinic: '' // Set clinic to blank
                    },
                    success: function (data) {
                        console.log(data);
                        let tableRows = '';
                        data.data.forEach(function (item) {
                            tableRows += `
                                <tr data-item-id="${item.id}">
                                    <td><input class="form-check-input mt-0 item-checkbox" type="checkbox"></td>
                                    <td>${item.item_code}</td>
                                    <td>${item.item_name}</td>
                                    <td>${item.brand_name}</td>
                                    <td>${item.CGST.toFixed(2)}%</td>
                                    <td>${item.SGST.toFixed(2)}%</td>
                                    <td>${item.IGST.toFixed(2)}%</td>
                                    <td><input class="form-check-input mt-0 suspend-checkbox" type="checkbox" ${item.suspend ? 'checked' : ''} disabled></td>
                                    <td>${item.availableStock}</td>
                                    <td>${item.stocking_uom}</td>
                                    <td style="display:none;"><input type="hidden" value="${item.purchase_uom}"></td>
                                    <td style="display:none;"><input type="hidden" name="item_id" value="${item.id}"></td>
                                    <td style="display:none;"><input type="hidden" value="${item.base_unit_cost_price}"></td>
                                    <td style="display:none;"><input type="hidden" value="${item.base_unit_mrp}"></td>
                                    <td style="display:none;"><input type="hidden" value="${item.discount_on_sale}"></td>
                                    <td style="display:none;"><input type="hidden" value="${item.hsn_codes}"></td>
                                    <td style="display:none;"><input type="hidden" value="${item.base_uom}"></td>
                                </tr>
                            `;
                        });
                        $('#tbodyid').html(tableRows);
        
                        // Add the select all checkbox functionality
                        $('#select-all-items').on('change', function () {
                            const isChecked = $(this).is(':checked');
                            $('#tbodyid input.item-checkbox').prop('checked', isChecked);
                        });
                    },
                    error: function (xhr, status, error) {
                        console.error('Error fetching item details:', error);
                    }
                });
            }
        
            function addSelectedItems() {
    $('#tbodyid input.item-checkbox:checked').each(function() {
        $('th.prth').css('display', 'none');
        const row = $(this).closest('tr');
        const itemCode = row.find('td:eq(1)').text();
        const itemName = row.find('td:eq(2)').text();
        const purchaseUOM = row.find('td:eq(10) input').val();
        const stockingUOM = row.find('td:eq(9)').text();
        const purchaseCostPrice = row.find('td:eq(13) input').val();
        const BaseMrp = row.find('td:eq(14) input').val();
        const discountOnSale = row.find('td:eq(14) input').val();
        const hsnCode = row.find('td:eq(15) input').val();
        const base_uom = row.find('td:eq(16) input').val();
        const availableStock = row.find('td:eq(8)').text();
        const gstApplicableOn = row.find('td:eq(15) input').val();
        const cgst = parseFloat(row.find('td:eq(4)').text().replace('%', ''));
const sgst = parseFloat(row.find('td:eq(5)').text().replace('%', ''));
const igst = parseFloat(row.find('td:eq(6)').text().replace('%', ''));

        const newRow = `
            <tr>
                <td><input type="text" name="not_applicable" class="form-control input-style" value="Not Applicable" readonly></td>
                <td><input type="text" name="item_code" class="form-control input-style" value="${itemCode}" readonly></td>
                <td><input type="text" name="item_name" class="form-control input-style" value="${itemName}" readonly></td>
                <td><input type="text" name="purchase_uom" class="form-control input-style" value="${purchaseUOM}" readonly></td>
                <td><input type="number" name="purchase_quantity" class="form-control input-style"></td>
                <td>
                    <select name="uom_select" class="form-control input-style">
                        <option value="${purchaseUOM}">${purchaseUOM}</option>
                        <option value="${stockingUOM}">${stockingUOM}</option>
                    </select>
                </td>
                <td><input type="text" name="stocking_uom" class="form-control input-style" value="${stockingUOM}" readonly></td>
                <td><input type="number" name="purchase_cost_price" class="form-control input-style" value="${purchaseCostPrice}" readonly></td>
                <td><input type="number" name="cost_amount" class="form-control input-style" readonly></td>
                <td><input type="number" name="mrp" class="form-control input-style" value="${BaseMrp}" readonly></td>
                <td><input type="number" name="amount" class="form-control input-style" readonly></td>
                <td><input type="number" name="available_stock" class="form-control input-style" value="${availableStock}" readonly></td>
                <td><input type="number" name="discount_percent" class="form-control input-style" value="${discountOnSale}"></td>
                <td><input type="number" name="discount_amount" class="form-control input-style" readonly></td>
                <td><input type="number" name="cgst_percent" class="form-control input-style" value="${cgst}" readonly></td>
                <td><input type="number" name="cgst_amount" class="form-control input-style" readonly></td>
                <td><input type="number" name="sgst_percent" class="form-control input-style" value="${sgst}" readonly></td>
                <td><input type="number" name="sgst_amount" class="form-control input-style" readonly></td>
                <td><input type="number" name="igst_percent" class="form-control input-style" value="${igst}" readonly></td>
                <td><input type="number" name="igst_amount" class="form-control input-style" readonly></td>
                <td><input type="number" name="net_amount" class="form-control input-style" readonly></td>
                <td><input type="text" name="specification" class="form-control input-style"></td>
                <td><input type="text" name="hsn_code" class="form-control input-style" value="${hsnCode}" readonly></td>
                <td style="display:none;"><input type="text" name="base_uom" class="form-control input-style" value="${base_uom}" readonly></td>
                <td><button type="button" class="btn btn-danger btn-sm remove-item"><i class="fa-solid fa-trash-can"></i></button></td>
            </tr>
        `;

        $('#main-table-body').append(newRow);
    });
}

            $('#addSelectedItemsBtn').on('click', addSelectedItems);
            function calculateRowAmounts(row) {
    let purchaseQuantity = parseFloat(row.find('input[name="purchase_quantity"]').val()) || 0;
    let purchaseCostPrice = parseFloat(row.find('input[name="purchase_cost_price"]').val()) || 0;
    let mrp = parseFloat(row.find('input[name="mrp"]').val()) || 0;
    let discountOnSale = parseFloat(row.find('input[name="discount_on_sale"]').val()) || 0;
    let cgstPercent = parseFloat(row.find('input[name="cgst_percent"]').val()) || 0;
    let sgstPercent = parseFloat(row.find('input[name="sgst_percent"]').val()) || 0;
    let igstPercent = parseFloat(row.find('input[name="igst_percent"]').val()) || 0;

    // Calculating Cost Amount = Purchase Cost Price * Purchase Quantity
    let costAmount = purchaseCostPrice * purchaseQuantity;

    // Calculating Amount = MRP * Purchase Quantity
    let amount = mrp * purchaseQuantity;

    // Calculating discount amount
    let discountAmount = (amount * discountOnSale) / 100;

    // Adjusting amount after discount
    let amountAfterDiscount = amount - discountAmount;

    // Calculating CGST, SGST, IGST Amounts on amount after discount
    let cgstAmount = (amountAfterDiscount * cgstPercent) / 100;
    let sgstAmount = (amountAfterDiscount * sgstPercent) / 100;
    let igstAmount = (amountAfterDiscount * igstPercent) / 100;

    // Calculating Net Amount = Amount after discount + CGST Amount + SGST Amount + IGST Amount
    let netAmount = amountAfterDiscount + cgstAmount + sgstAmount + igstAmount;

    // Updating the row with the calculated values
    row.find('input[name="cost_amount"]').val(costAmount.toFixed(2));
    row.find('input[name="amount"]').val(amount.toFixed(2));
    row.find('input[name="discount_amount"]').val(discountAmount.toFixed(2));
    row.find('input[name="cgst_amount"]').val(cgstAmount.toFixed(2));
    row.find('input[name="sgst_amount"]').val(sgstAmount.toFixed(2));
    row.find('input[name="igst_amount"]').val(igstAmount.toFixed(2));
    row.find('input[name="net_amount"]').val(netAmount.toFixed(2));

    // Update the totals in the form-row section
    updateTotals();
}
 function calculateTotals() {
    let totalCgst = 0;
    let totalSgst = 0;
    let totalIgst = 0;
    let totalDiscount = 0;
    let totalNetAmount = 0;

    // Calculate totals based on each row in the main table
    $('#main-table-body tr').each(function () {
        let row = $(this);
        totalCgst += parseFloat(row.find('input[name="cgst_amount"]').val()) || 0;
        totalSgst += parseFloat(row.find('input[name="sgst_amount"]').val()) || 0;
        totalIgst += parseFloat(row.find('input[name="igst_amount"]').val()) || 0;
        totalDiscount += parseFloat(row.find('input[name="discount_amount"]').val()) || 0;
        totalNetAmount += parseFloat(row.find('input[name="net_amount"]').val()) || 0;
    });

    // Display the totals in the respective fields
    $('input[name="total_cgst"]').val(totalCgst.toFixed(2));
    $('input[name="total_sgst"]').val(totalSgst.toFixed(2));
    $('input[name="total_igst"]').val(totalIgst.toFixed(2));
    $('input[name="total_discount"]').val(totalDiscount.toFixed(2));

    // Gross amount is the initial total net amount before applying other charges and PO discount
    $('input[name="gross_amount"]').val(totalNetAmount.toFixed(2));

    // Apply Other Charges if any
    let otherCharges = parseFloat($('input[name="other_charges"]').val()) || 0;
    totalNetAmount += otherCharges;

    // Apply PO Discount if any
    let poDiscount = parseFloat($('input[name="po_discount"]').val()) || 0;
    totalNetAmount -= poDiscount;

    // Display the final Total Net Amount
    $('input[name="total_net_amount"]').val(totalNetAmount.toFixed(2));
}

// Recalculate totals whenever the PO Discount or Other Charges are updated
$('input[name="po_discount"], input[name="other_charges"]').on('input', function() {
    calculateTotals();
});

// Initial calculation to set the values
calculateTotals();

            function updateTotals() {
                calculateTotals();
            }
        
            // Handle changes in "Other Charges" to update the Net Amount
            $('input[name="other_charges"]').on('input', function() {
                let otherCharges = parseFloat($(this).val()) || 0;
                let grossAmount = parseFloat($('input[name="gross_amount"]').val()) || 0;
                let newNetAmount = grossAmount + otherCharges;
        
                $('input[name="total_net_amount"]').val(newNetAmount.toFixed(2));
            });
        
            $(document).on('input', 'input[name="purchase_quantity"], input[name="discount_amount"]', function () {
    let row = $(this).closest('tr');

    // Determine if the row is a PR row or a regular item row based on some condition
    // For example, you might check if the row has a certain data attribute or class
    if (row.data('item-id') && fetchedPRItems.hasOwnProperty(row.data('item-id'))) {
        // This is a PR row, run PR-specific calculations
        calculatePRRowAmounts(row);
        calculatePRTotals();
    } else {
        // This is a regular item row, run standard calculations
        calculateRowAmounts(row);
        calculateTotals();
    }
});

        
            $('#addItems').click(function (e) {
                let from_store = $('#store').val();
        
                if (!from_store || from_store === 'Select') {
                    alert('Please select From store.');
                    e.preventDefault(); // Prevent the default action of opening the modal
                    e.stopPropagation(); // Stop the event from bubbling up
                    return;
                }
        
                fetchData(from_store);
            });

            // Handle form submission
$('#saveFormBtn').click(function () {
    let formData = {
        clinic: $('#clinic').val(), // Assuming you have a clinic field
        date: $('#date').val(), // Assuming you have a clinic field
        store: $('#store').val(),
        payment_mode: $('#payment_mode').val(),
        supplier: $('#supplier').val(),
        payment_terms: $('#payment_terms').val(),
        delivery: $('#delivery').val(),
        delivery_duration: $('#delivery_duration').val(),
        guarantee_warranty: $('[name="guarantee_warranty"]').val(),
        schedule: $('[name="schedule"]').val(),
        instructions: $('[name="instructions"]').val(),
        gross_amount: $('[name="gross_amount"]').val(),
        total_cgst: $('[name="total_cgst"]').val(),
        total_sgst: $('[name="total_sgst"]').val(),
        total_igst: $('[name="total_igst"]').val(),
        other_charges: $('[name="other_charges"]').val(),
        total_discount: $('[name="total_discount"]').val(),
        po_discount: $('[name="po_discount"]').val(),
        total_net_amount: $('[name="total_net_amount"]').val(),
        remarks: $('[name="remarks"]').val(),
        items: []
    };

    $('#main-table-body tr').each(function () {
    let row = $(this); // Cache the current row in a variable for better performance
    let itemData = {
        item_id: row.data('item-id'),
        item_code: row.find('input[name="item_code"]').val(),
        item_name: row.find('input[name="item_name"]').val(),
        pr_quantity: row.find('input[name="pr_quantity"]').val() || 0,
        pr_pending_quantity: row.find('input[name="pr_pending_quantity"]').val() || 0,
        purchase_uom: row.find('input[name="purchase_uom"]').val() ,
        purchase_quantity: row.find('input[name="purchase_quantity"]').val(),
        transaction_uom: row.find('select[name="uom_select"]').val(),
        stocking_uom: row.find('input[name="stocking_uom"]').val(),
        purchase_cost_price: row.find('input[name="purchase_cost_price"]').val(),
        cost_amount: row.find('input[name="cost_amount"]').val(),
        mrp: row.find('input[name="mrp"]').val(),
        amount: row.find('input[name="amount"]').val(),
        available_stock: row.find('input[name="available_stock"]').val(),
        discount_percent: row.find('input[name="discount_percent"]').val(),
        discount_amount: row.find('input[name="discount_amount"]').val(),
        cgst_percent: row.find('input[name="cgst_percent"]').val(),
        cgst_amount: row.find('input[name="cgst_amount"]').val(),
        sgst_percent: row.find('input[name="sgst_percent"]').val(),
        sgst_amount: row.find('input[name="sgst_amount"]').val(),
        igst_percent: row.find('input[name="igst_percent"]').val(),
        igst_amount: row.find('input[name="igst_amount"]').val(),
        net_amount: row.find('input[name="net_amount"]').val(),
        specification: row.find('input[name="specification"]').val(),
        hsn_code: row.find('input[name="hsn_code"]').val()
    };

    formData.items.push(itemData);
});

    axios.post('/palashinv/save-purchase-order', formData)
        .then(function (response) {
            alert('Data saved successfully');
            console.log(response);
            $('#errordiv1').addClass('alert-success').removeClass('alert-danger').text(response.data.message).show();
        })
        .catch(function (error) {
            console.error('Error saving data:', error);
            $('#errordiv1').removeClass('alert-success').addClass('alert-danger').text(error.response.data.message).show();
            alert('Failed to save data');
        });
});

        </script>
        
        
        
        
</body>

</html>
