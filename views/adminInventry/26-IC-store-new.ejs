<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>LifeLinker</title>

    <!-- Template CSS -->
    <link rel="stylesheet" href="assets/css/style-starter.css?v=0.2">
    <%-include('../header');-%>

        <!-- //header-ends -->
        <!-- main content start -->
        <div class="main-content">

            <div class="row content-top-gap2">
                <div class="col-lg-12">
                    <nav class="navbar navbar-expand-lg navbar-light bg-white">
                        <a class="navbar-brand text-center mr-5" href="#">
                            <span class="dash-icon"><i class="fas fa-tachometer-alt"></i></span>
                            Dashboard
                        </a>
                        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
                            aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                        <div class="collapse navbar-collapse" id="navbarNav">
                            <ul class="navbar-nav">
                                <li class="nav-item active text-center mr-5">
                                    <a class="nav-link" href="#">
                                        <span class="dash-icon"><i class="far fa-user"></i></span>
                                        Master
                                    </a>
                                </li>
                                <li class="nav-item text-center mr-5">
                                    <a class="nav-link" href="#">
                                        <span class="dash-icon"><i class="fas fa-exchange-alt"></i></span>
                                        Transaction
                                    </a>
                                </li>
                                <li class="nav-item text-center mr-5">
                                    <a class="nav-link" href="#">
                                        <span class="dash-icon"><i class="fas fa-hand-holding-medical"></i></span>
                                        Patient 360
                                    </a>
                                </li>
                                <li class="nav-item text-center mr-5">
                                    <a class="nav-link" href="#">
                                        <span class="dash-icon"><i class="fas fa-receipt"></i></span>
                                        Outside Reciept
                                    </a>
                                </li>
                                <li class="nav-item text-center mr-5">
                                    <a class="nav-link" href="#">
                                        <span class="dash-icon"><i class="fas fa-file-invoice"></i></span>
                                        Outpatient Department
                                    </a>
                                </li>
                                <li class="nav-item text-center mr-5">
                                    <a class="nav-link" href="#">
                                        <span class="dash-icon"><i class="fas fa-chart-line"></i></span>
                                        Analytics
                                    </a>
                                </li>
                                <li class="nav-item text-center mr-5">
                                    <a class="nav-link" href="#">
                                        <span class="dash-icon"><i class="far fa-clock"></i></span>
                                        Waiting List
                                    </a>
                                </li>
                                <li class="nav-item text-center mr-5">
                                    <a class="nav-link" href="#">
                                        <span class="dash-icon"><i class="fas fa-wrench"></i></span>
                                        Adminstration
                                    </a>
                                </li>
                                <li class="nav-item text-center">
                                    <a class="nav-link" href="#">
                                        <span class="dash-icon"><i class="fas fa-spinner"></i></span>
                                        Additional
                                    </a>
                                </li>

                            </ul>
                        </div>
                    </nav>
                </div>
            </div>
            <!-- content -->
            <div class="container-fluid">

                <div class="chart">
                    <div class="row">

                        <div class="col-lg-12 pl-lg-0 mt-2 ml-2">
                            <h4 class="primary">Store</h4>
                        </div>
                        <div class="col-lg-12 pl-lg-2 chart-grid">
                            <div id="errordiv1"></div>
                            <form id="Store" method="post">
                                <div class="card card_border">
                                    <div>
                                        <!--Past your code here starts-->

                                        
                                        <div class="card">
                                            <div class="mt-3 ml-3">
                                                <h6 class="primary">Store Details</h6>
                                            </div>
                                            <div class="form-row pl-lg-3 pr-lg-3 mt-2 mb-2">
                                                <div class="col-3 mb-3">
                                                    <div class="form-group">
                                                        <label class="input__label">Clinic</label>
                                                        <select id="clinic" name="clinic"  class="form-control input-style" data-validation="required" data-error-message="Clinic is required">
                                                            <option value="<%= result.clinic ? result.clinic : '' %>" > <%= result.id ? result.clinic : 'Select' %></option>
                                                            
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-3 mb-3">
                                                    <div class="form-group">
                                                        <label class="input__label">Parent Store</label>
                                                        <select id="parent_store" name="parent_store"  class="form-control input-style" data-validation="required" data-error-message="Parent Store is required">
                                                            <option value="<%= result.parent_store ? result.parent_store : '' %>"><%= result.id ? result.parent_store : 'Select' %></option>
                                                            <% if (parentStore.length>0) {
                                                                for (let i = 0; i < parentStore.length; i++) { %>
                                                                    <option value="<%= parentStore[i].description%>"><%= parentStore[i].description%></option>
                                                                    <% } } else { %>
                                                                
                                                                            <option>No any Cost Center Code</option>
                                                                    
                                                                        <% } %>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-3 mb-3">
                                                    <div class="form-group">
                                                        <label class="input__label">Cost Center Code</label>
                                                        <select id="cost_center_code" name="cost_center_code" class="form-control input-style" data-validation="required" data-error-message="Cost Center Code is required">
                                                            <option value="<%= result.cost_center_code ? result.cost_center_code : '' %>"><%= result.id ? result.cost_center_code : 'Select' %></option>
                                                            <% if (costCentCode.length>0) {
                                                                for (let i = 0; i < costCentCode.length; i++) { %>
                                                                    <option value="<%= costCentCode[i].description%>"><%= costCentCode[i].description%></option>
                                                                    <% } } else { %>
                                                                
                                                                            <option>No any Cost Center Code</option>
                                                                    
                                                                        <% } %>

                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-3 mb-3">
                                                    <div class="form-group">
                                                        <label class="input__label">Code </label>
                                                        <input id="code" name="code" type="text" class="form-control input-style" data-validation="required" data-error-message="Code is required" placeholder="" value="<%= result.code %>" <%= result.id ? 'disabled' : '' %>>
                                                    </div>
                                                </div>
                                                <div class="col-3">
                                                    <div class="form-group">
                                                        <label class="input__label">Description</label>
                                                        <input id="description" name="description" type="text" class="form-control input-style" data-validation="required" data-error-message="Description is required" placeholder="" value="<%= result.description %>">
                                                    </div>
                                                </div>
                                                <div class="col-3">
                                                    <div class="form-check-label">
                                                        <label class="input__label"></label>
                                                        <div class="radio my-4">
                                                            <label class="form-check-label">
                                                                <input id="apply_all_items" name="apply_all_items" class="form-check-input " type="radio" data-validation="required" data-error-message="Apply All Items is required" <%= result.apply_all_items==1 ? 'checked' : '' %> >
                                                                Apply All Items To Store
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-3">
                                                    <div class="form-check-label">
                                                        <label class="input__label"></label>
                                                        <div class="radio my-4">
                                                            <label class="form-check-label">
                                                                <input id="apply_to_category" name="apply_to_category" class="form-check-input " type="radio" data-validation="required" data-error-message="Apply To Category is required" <%= result.apply_to_category==1 ? 'checked' : '' %>>
                                                                Apply To Category Wise Items
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-3">
                                                    <div class="form-check-label">
                                                        <label class="input__label"></label>
                                                        <div class="radio my-4">
                                                            <label class="form-check-label">
                                                                <input id="is_quarantine_store" name="is_quarantine_store" class="form-check-input " type="checkbox" data-validation="required" data-error-message="Is Quarantine Store is required" <%= result.is_quarantine_store==1 ? 'checked' : '' %>>
                                                                Is Quarantine Store
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                      
                    </div>
                    <div class="form-group mb-3 text-right">



                        <button type="submit" class="btn-success btn-style btn mt-3 mr-2" id="mod-btn" onclick="updateQuery()"><strong><i
                            class="fa-regular fa-pen-to-square"></i> Modify</strong></button>

                <button type="button" class="btn-secondary btn-style btn mt-3 mr-2" disabled data-bs-target="#myModal" data-bs-toggle="modal"><strong><i
                            class="fa-solid fa-plus"></i> New</strong></button>

                <a type="button" class="btn-danger btn-style btn mt-3 mr-2" href="/adminInv/6"><strong><i
                            class="fas fa-times"></i> Cancel</strong></a>

                <button type="submit" class="btn-primary btn-style btn mt-3" id="sub-btn"><strong><i
                            class="far fa-save"></i>
                        Save</strong></button>
                    </div>

                    </form>
                    <div id="loadingDiv"></div>

                </div>
                <!--footer section start-->
                <%-include('../footer');-%>
                <script>
                    function loadClinic(a) {
                    fetch('/adminInv/get-clinic-details')
                      .then(response => response.json())
                      .then(data => {

                        console.log(data)
                        const dropdown = document.getElementById(a);
                        data.forEach(item => {
                          const option = document.createElement('option');
                          option.value = item.clinic_desc;
                          option.textContent = item.clinic_desc;
                          dropdown.appendChild(option);

                        });
                      })
                      .catch(error => console.error('Error fetching states:', error));
                  }
                  loadClinic('clinic');
                  
                    $('#clustur-dtl').on('click', '#view_btn', function() {
                    const clus_id=$(this).closest('tr').data('clustur-id')
                    const route='24'
                    const module='clinic'
                    ViewBtn(route,clus_id,module)
                
                    });
                </script>

                <script>
                    function updateQuery(){
                console.log("Onclick");
$('#mod-btn').prop('disabled', true);   
$('input[data-validation], select[data-validation]').prop('disabled', false);
$('#code').prop('disabled', true);
document.getElementById('sub-btn').disabled = false;
}
if('<%= result.id %>'!==''){

$('input[data-validation], select[data-validation]').prop('disabled', true);
document.getElementById('sub-btn').disabled = true;
document.getElementById('mod-btn').disabled = false;

}else{

document.getElementById('mod-btn').disabled = true;
}
                </script>


                <script type="module">
                    import { validateForm } from '../javascripts/validation.js';
                    import { myAjax } from '../javascripts/myAjax.js';
                
                    $(document).ready(function() {
                        console.log("Document is ready");
                
                        // Handle final submit button click
                        $('#Store').on('submit', function(event) {
                            event.preventDefault();
                            submitForms(event);
                        });
                
                        // Function to submit forms
                        const submitForms = (event) => {
                            event.preventDefault();
                
                            const storeFormDetails = validateForm('#Store');
                            const { isValid: isStoreFormValid, errorMessage: storeFormError, formData: storeFormData } = storeFormDetails;
                
                            // Handle checkbox values
                            storeFormData.apply_all_items = $('#apply_all_items').is(':checked') ? true : false;
                            storeFormData.apply_to_category = $('#apply_to_category').is(':checked') ? true : false;
                            storeFormData.is_quarantine_store = $('#is_quarantine_store').is(':checked') ? true : false;
                
                            console.log(storeFormData);
                            let id='<%= result.id %>'
                            if(id){
                                storeFormData.id=id
                            }
                            const errorDivId = '#errordiv1';
                
                            if (isStoreFormValid) {
                                const url = '/adminInv/StoreSubmit';
                                const loadingDiv = '#loadingDiv';
                                myAjax(storeFormData, errorDivId, url, loadingDiv);
                            } else {
                                alert(storeFormError);
                                $(errorDivId).removeClass('alert-success').addClass('alert-danger').text(storeFormError).show();
                            }
                        };
                
                        // Function to reset forms
                        const resetForms = () => {
                            $('#Store')[0].reset();
                            // Hide error messages
                            $('#errordiv1').hide();
                        };
                
                        // Attach reset function to cancel button
                        $('#submitCancel').on('click', function() {
                            resetForms();
                        });
                    });
                </script>
                