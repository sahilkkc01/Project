<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>LifeLinker</title>

    <!-- Template CSS -->
   <%- include('../header'); -%>


        <!-- //header-ends -->
        <!-- main content start -->
        <div class="main-content">

            <div class="row content-top-gap2">
                <div class="col-lg-12">
                    <nav class="navbar navbar-expand-lg navbar-light bg-white">
                        <a class="navbar-brand text-center mr-5" href="#">
                            <span class="dash-icon"><i class="fas fa-tachometer-alt"></i></span>
                            Dashboard
                        </a>
                        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
                            aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                        <div class="collapse navbar-collapse" id="navbarNav">
                            <ul class="navbar-nav">
                                <li class="nav-item active text-center mr-5">
                                    <a class="nav-link" href="#">
                                        <span class="dash-icon"><i class="far fa-user"></i></span>
                                        Master
                                    </a>
                                </li>
                                <li class="nav-item text-center mr-5">
                                    <a class="nav-link" href="#">
                                        <span class="dash-icon"><i class="fas fa-exchange-alt"></i></span>
                                        Transaction
                                    </a>
                                </li>
                                <li class="nav-item text-center mr-5">
                                    <a class="nav-link" href="#">
                                        <span class="dash-icon"><i class="fas fa-hand-holding-medical"></i></span>
                                        Patient 360
                                    </a>
                                </li>
                                <li class="nav-item text-center mr-5">
                                    <a class="nav-link" href="#">
                                        <span class="dash-icon"><i class="fas fa-receipt"></i></span>
                                        Outside Reciept
                                    </a>
                                </li>
                                <li class="nav-item text-center mr-5">
                                    <a class="nav-link" href="#">
                                        <span class="dash-icon"><i class="fas fa-file-invoice"></i></span>
                                        Outpatient Department
                                    </a>
                                </li>
                                <li class="nav-item text-center mr-5">
                                    <a class="nav-link" href="#">
                                        <span class="dash-icon"><i class="fas fa-chart-line"></i></span>
                                        Analytics
                                    </a>
                                </li>
                                <li class="nav-item text-center mr-5">
                                    <a class="nav-link" href="#">
                                        <span class="dash-icon"><i class="far fa-clock"></i></span>
                                        Waiting List
                                    </a>
                                </li>
                                <li class="nav-item text-center mr-5">
                                    <a class="nav-link" href="#">
                                        <span class="dash-icon"><i class="fas fa-wrench"></i></span>
                                        Adminstration
                                    </a>
                                </li>
                                <li class="nav-item text-center">
                                    <a class="nav-link" href="#">
                                        <span class="dash-icon"><i class="fas fa-spinner"></i></span>
                                        Additional
                                    </a>
                                </li>

                            </ul>
                        </div>
                    </nav>
                </div>
            </div>
            <!-- content -->
            <div class="container-fluid">

                <div class="chart">
                    <div class="row">

                        <div class="col-lg-12 pl-lg-0 mt-2 ml-2">
                            <h4 class="primary">Bulk Rate Change</h4>
                        </div>
                        <div class="col-lg-12 pl-lg-2 chart-grid">
                            <form>
                                <div class="card card_border">
                                    <div>
                                        <!--Past your code here starts-->

                                        <div class="card">

                                            <!-- Nav Tabs are here once have a look--->
                                            <div>
                                                <div class="form-group">
                                                    <div class="col-xl-12 p-heading">
                                                        <h6 class="p-text">Specialization</h6>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                        <!--Past your code here ends-->
                                    </div>
                                </div>
                        </div>
                        <!--section2-->

                        <div class="mt-1 col-lg-6 pl-lg-2">
                            <div class="card card_border">
                                <div class="mb-2">
                                    <div class="form-group">
                                        <div class="col-xl-12 p-heading">
                                            <h6 class="p-text">LIST OF TERIFF</h6>
                                        </div>
                                    </div>
                                </div>


                                <div class="form-row">
                                    <div class="col-12 mb-3  pl-lg-3 pr-lg-3">


                                        <div>
                                            <h6 class="primary">Advance Filter</h6>
                                        </div>
                                        <div class="form-row mb-2">
                                            <div class="col-12">
                                                <div class="form-group"><label class="input__label">Tariff</label><input
                                                        name="code" type="text" class="form-control input-style" id="searchBox"
                                                        placeholder="">
                                                </div>
                                            </div>

                                        </div>

                                        <div class="slidx">
                                            <table class="table2" id="bcExp">
                                                <thead>
                                                    <tr>
                                                        <th contenteditable="true" width="20%">Select
                                                        </th>
                                                        <th contenteditable="true" width="50%">Code</th>
                                                        <th contenteditable="true" width="50%">Name</th>
                                                        <th contenteditable="true"></th>
                                                    </tr>
                                                </thead>
                                                <tbody id="exp-table">


                                                </tbody>
                                            </table>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>


                        <div class="mt-1 col-lg-6">
                            <div class="card card_border">
                                <div class="mb-2">
                                    <div class="form-group">
                                        <div class="col-xl-12 p-heading">
                                            <h6 class="p-text">LIST OF SELECTED TERIFF</h6>
                                        </div>
                                    </div>
                                </div>


                                <div class="form-row">

                                    <div class="col-12 mb-3 pl-lg-3 pr-lg-3">








                                        <div class="slidx">
                                            <table class="table2">
                                                <thead>
                                                    <tr>
                                                        <th contenteditable="true" width="40%">Tariff Code</th>
                                                        <th contenteditable="true" width="40%">Tariff Name</th>
                                                        <th contenteditable="true">Delete</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="apnd">

                                                </tbody>
                                            </table>
                                        </div>
                                        <div id="paginationControls"></div>
                                    </div>
                                </div>


                            </div>


                        </div>



                        <div class="mt-1 col-lg-12 pl-lg-2 mt-4">
                            <div class="card card_border">
                                <!-- <div class="mb-3">
                                    <div class="form-group">
                                        <div class="col-xl-12 p-heading">
                                            <h6 class="p-text">LIST OF SELECTED TERIFF</h6>
                                        </div>
                                    </div>
                                </div> -->


                                <div class="form-row">

                                    <div class="col-12 mb-3 pl-lg-3 pr-lg-3">


                                        <div class="form-row">
                                            <div class="col-4">
                                                <div class="form-group"><label
                                                        class="input__label">Remarks</label><textarea name=""
                                                        class="form-control input-style" placeholder=""></textarea>
                                                </div>
                                            </div>

                                            <div class="col-4">
                                                <div class="row  text-left">
                                                    <div class="col-6 mt-3 py-3 px-5">
                                                        <input class="form-check-input" type="checkbox" id="gridCheck1">
                                                        <label class="form-check-label mr-5" for="gridCheck1">Effective
                                                            Date</label>
                                                    </div>

                                                    <div class="col-6 py-2 px-6">
                                                        <div class="form-group"><label for=""></label><input name="code"
                                                                type="date" class="form-control input-style"
                                                                placeholder="">
                                                        </div>
                                                    </div>
                                                </div>

                                            </div>

                                            <div class="col-4 mt-3 py-3 pr-4">
                                                <div class="form-group text-right">
                                                    <input class="form-check-input" type="checkbox" id="gridCheck1">
                                                    <label class="form-check-label mr-5" for="gridCheck1">Is
                                                        Freeze</label>
                                                </div>
                                            </div>


                                        </div>







                                    </div>
                                </div>


                            </div>


                        </div>


                    </div>
                    <div class="form-group mt-1 mb-3 text-right">

                        <button type="button" class="btn-success btn-style btn mt-3 mr-2"><strong><i
                                    class="fa-regular fa-pen-to-square"></i> Modify</strong></button>

                        <button type="button" class="btn-secondary btn-style btn mt-3 mr-2" disabled><strong><i
                                    class="fa-solid fa-plus"></i> New</strong></button>

                        <button type="button" class="btn-danger btn-style btn mt-3 mr-2"
                            onclick="window.location.href='/billing/21'"><strong><i class="fas fa-times"></i>
                                Cancel</strong></button>

                        <button type="button" class="btn-primary btn-style btn mt-3"><strong><i class="far fa-save"></i>
                                Save</strong></button>
                    </div>

                    </form>

                </div>
                <!--footer section start-->
               <%- include('../footer'); -%>

                    <script src="../javascripts/statusUpdate.js"></script>
                    <script src="../javascripts/pageUpdate.js"></script>
                    <script>

                        function ChangeStatus3(b) {
                            console.log(b);
                            let url = '/billing/change-tariff-master-status'
                            updateStatus(b, url)
                        }

                        function updateExp(id) {

                            // console.log(id);
                            let url = '/billing/update-tarr-mst'
                            updatePage(id, url)
                        }
                    </script>

                    <script type="module">
                        import { pagi_search } from '../javascripts/pagi_search.js';

                        // console.log(statusUpdate);
                        $(document).ready(function () {
                            // Function to fetch and display data
                            function fetchData() {
                                $.ajax({
                                    url: '/billing/get_tariff_master',
                                    type: 'GET',
                                    success: function (data) {
                                        data.reverse();
                                        let tableRows = '';
                                        data.forEach(function (item) {
                                            tableRows += `
                                           <tr>
    <td><input type="checkbox" class="tariff-checkbox" value="${item.trf_code}"></td>
    <td>${item.trf_code}</td>
    <td>${item.trf_name}</td>
</tr>

                                            `;
                                        });
                                        $('#exp-table').html(tableRows);
                                        pagi_search('#searchBox', '#bcExp', '#paginationControls');
                                    },
                                    error: function (xhr, status, error) {
                                        console.error('Error fetching classification details:', error);
                                    }
                                });
                            }
                            fetchData();
                        });
                    </script>



                    <script type="module">
                        import { validateForm } from '../javascripts/validation.js';
                        import { myAjax } from '../javascripts/myAjax.js';
                        $(document).ready(function () {
    // Function to append rows to the "List of Selected Tariff" table
    function appendRow(trfCode, trfName) {
        var row = `<tr>
                    <td>${trfCode}</td>
                    <td>${trfName}</td>
                    <td><button class="delete-tariff btn-danger btn-style btn mt-3 mr-2">Delete</button></td>
                </tr>`;
        $('#apnd').append(row);
    }

    // Checkbox change handler for adding or removing tariffs
    $('#exp-table').on('change', '.tariff-checkbox', function() {
        var trfCode = $(this).closest('tr').find('td:eq(1)').text();
        var trfName = $(this).closest('tr').find('td:eq(2)').text();
        if (this.checked) {
            appendRow(trfCode, trfName);
        } else {
            $('#apnd').find('tr').each(function() {
                if ($(this).find('td:eq(0)').text() === trfCode) {
                    $(this).remove();
                }
            });
        }
    });

    // Event handler for deleting a tariff from the "List of Selected Tariff" table
    $('#apnd').on('click', '.delete-tariff', function() {
        var trfCode = $(this).closest('tr').find('td:eq(0)').text();
        $(this).closest('tr').remove();
        // Uncheck the corresponding checkbox in the "List of Tariff" table
        $('#exp-table').find('.tariff-checkbox').each(function() {
            if ($(this).closest('tr').find('td:eq(1)').text() === trfCode) {
                $(this).prop('checked', false);
            }
        });
    });

    // Form submission event
    $('#BCbulkRateChangr').on('submit', function (event) {
        event.preventDefault();
        const selectedTariffs = $('#apnd tr').map(function() {
            return {
                trf_code: $(this).find('td:eq(0)').text(),
                trf_name: $(this).find('td:eq(1)').text()
            };
        }).get();

        const { isValid, errorMessage, formData } = validateForm('#BCbulkRateChangr');

        if (isValid) {
            formData['selectedTariffs'] = selectedTariffs;
            myAjax(formData, '#errordiv1', '/billing/bc-bl-rate-change', '#loadingIndicator');
        } else {
            alert(errorMessage);
            $('#errordiv1').removeClass('alert-success').addClass('alert-danger').text(errorMessage).show();
        }
    });
});

 </script>